<!DOCTYPE html><html lang="en">
  <head><!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-85831520-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-85831520-1');
		
	</script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"><title>How to draw a variety of maps with folium in python? - Jingwen Zheng</title>

<meta name="description" content="This blog talks about how to draw a map with python module &quot;folium&quot;, like how to display all locations with points or with cluster, how to paint ar...">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>How to draw a variety of maps with folium in python? | Jingwen Zheng</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="How to draw a variety of maps with folium in python?" />
<meta name="author" content="Jingwen Zheng" />
<meta property="og:locale" content="en" />
<meta name="description" content="This blog talks about how to draw a map with python module “folium”, like how to display all locations with points or with cluster, how to paint areas with different colors, how to add labels or polygon borders, show changes in terms of timing with heatmap or with choropleth." />
<meta property="og:description" content="This blog talks about how to draw a map with python module “folium”, like how to display all locations with points or with cluster, how to paint areas with different colors, how to add labels or polygon borders, show changes in terms of timing with heatmap or with choropleth." />
<link rel="canonical" href="https://jingwen-z.github.io/how-to-draw-a-variety-of-maps-with-folium-in-python/" />
<meta property="og:url" content="https://jingwen-z.github.io/how-to-draw-a-variety-of-maps-with-folium-in-python/" />
<meta property="og:site_name" content="Jingwen Zheng" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-11-08T20:55:41+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="How to draw a variety of maps with folium in python?" />
<meta name="twitter:site" content="@Jingwen_QI" />
<meta name="twitter:creator" content="@Jingwen Zheng" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jingwen Zheng"},"dateModified":"2019-11-08T20:55:41+01:00","datePublished":"2019-11-08T20:55:41+01:00","description":"This blog talks about how to draw a map with python module “folium”, like how to display all locations with points or with cluster, how to paint areas with different colors, how to add labels or polygon borders, show changes in terms of timing with heatmap or with choropleth.","headline":"How to draw a variety of maps with folium in python?","mainEntityOfPage":{"@type":"WebPage","@id":"https://jingwen-z.github.io/how-to-draw-a-variety-of-maps-with-folium-in-python/"},"url":"https://jingwen-z.github.io/how-to-draw-a-variety-of-maps-with-folium-in-python/"}</script>
<!-- End Jekyll SEO tag -->


<!-- Extra Open Graph :: Start -->

<!-- Extra Open Graph :: End -->

<link rel="canonical" href="https://jingwen-z.github.io/how-to-draw-a-variety-of-maps-with-folium-in-python/"><link rel="alternate" type="application/rss+xml" title="Jingwen Zheng" href="/feed.xml"><!-- start favicons snippet, use https://realfavicongenerator.net/ --><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="manifest" href="/assets/site.webmanifest"><link rel="mask-icon" href="/assets/safari-pinned-tab.svg" color="#fc4d50"><link rel="shortcut icon" href="/assets/favicon.ico">

<meta name="msapplication-TileColor" content="#ffc40d"><meta name="msapplication-config" content="/assets/browserconfig.xml">

<meta name="theme-color" content="#ffffff">
<!-- end favicons snippet --><link rel="stylesheet" href="/assets/css/main.css"><link rel="stylesheet" href="/assets/css/font-awesome-5.15.1-all.min.css" ><!-- start custom head snippets -->

<!-- end custom head snippets -->
<script>(function() {
  window.isArray = function(val) {
    return Object.prototype.toString.call(val) === '[object Array]';
  };
  window.isString = function(val) {
    return typeof val === 'string';
  };

  window.hasEvent = function(event) {
    return 'on'.concat(event) in window.document;
  };

  window.isOverallScroller = function(node) {
    return node === document.documentElement || node === document.body || node === window;
  };

  window.isFormElement = function(node) {
    var tagName = node.tagName;
    return tagName === 'INPUT' || tagName === 'SELECT' || tagName === 'TEXTAREA';
  };

  window.pageLoad = (function () {
    var loaded = false, cbs = [];
    window.addEventListener('load', function () {
      var i;
      loaded = true;
      if (cbs.length > 0) {
        for (i = 0; i < cbs.length; i++) {
          cbs[i]();
        }
      }
    });
    return {
      then: function(cb) {
        cb && (loaded ? cb() : (cbs.push(cb)));
      }
    };
  })();
})();
(function() {
  window.throttle = function(func, wait) {
    var args, result, thisArg, timeoutId, lastCalled = 0;

    function trailingCall() {
      lastCalled = new Date;
      timeoutId = null;
      result = func.apply(thisArg, args);
    }
    return function() {
      var now = new Date,
        remaining = wait - (now - lastCalled);

      args = arguments;
      thisArg = this;

      if (remaining <= 0) {
        clearTimeout(timeoutId);
        timeoutId = null;
        lastCalled = now;
        result = func.apply(thisArg, args);
      } else if (!timeoutId) {
        timeoutId = setTimeout(trailingCall, remaining);
      }
      return result;
    };
  };
})();
(function() {
  var Set = (function() {
    var add = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (data[i] === item) {
          return;
        }
      }
      this.size ++;
      data.push(item);
      return data;
    };

    var Set = function(data) {
      this.size = 0;
      this._data = [];
      var i;
      if (data.length > 0) {
        for (i = 0; i < data.length; i++) {
          add.call(this, data[i]);
        }
      }
    };
    Set.prototype.add = add;
    Set.prototype.get = function(index) { return this._data[index]; };
    Set.prototype.has = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (this.get(i) === item) {
          return true;
        }
      }
      return false;
    };
    Set.prototype.is = function(map) {
      if (map._data.length !== this._data.length) { return false; }
      var i, j, flag, tData = this._data, mData = map._data;
      for (i = 0; i < tData.length; i++) {
        for (flag = false, j = 0; j < mData.length; j++) {
          if (tData[i] === mData[j]) {
            flag = true;
            break;
          }
        }
        if (!flag) { return false; }
      }
      return true;
    };
    Set.prototype.values = function() {
      return this._data;
    };
    return Set;
  })();

  window.Lazyload = (function(doc) {
    var queue = {js: [], css: []}, sources = {js: {}, css: {}}, context = this;
    var createNode = function(name, attrs) {
      var node = doc.createElement(name), attr;
      for (attr in attrs) {
        if (attrs.hasOwnProperty(attr)) {
          node.setAttribute(attr, attrs[attr]);
        }
      }
      return node;
    };
    var end = function(type, url) {
      var s, q, qi, cbs, i, j, cur, val, flag;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        s[url] = true;
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (cur.urls.has(url)) {
            qi = cur, val = qi.urls.values();
            qi && (cbs = qi.callbacks);
            for (flag = true, j = 0; j < val.length; j++) {
              cur = val[j];
              if (!s[cur]) {
                flag = false;
              }
            }
            if (flag && cbs && cbs.length > 0) {
              for (j = 0; j < cbs.length; j++) {
                cbs[j].call(context);
              }
              qi.load = true;
            }
          }
        }
      }
    };
    var load = function(type, urls, callback) {
      var s, q, qi, node, i, cur,
        _urls = typeof urls === 'string' ? new Set([urls]) : new Set(urls), val, url;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (_urls.is(cur.urls)) {
            qi = cur;
            break;
          }
        }
        val = _urls.values();
        if (qi) {
          callback && (qi.load || qi.callbacks.push(callback));
          callback && (qi.load && callback());
        } else {
          q.push({
            urls: _urls,
            callbacks: callback ? [callback] : [],
            load: false
          });
          for (i = 0; i < val.length; i++) {
            node = null, url = val[i];
            if (s[url] === undefined) {
              (type === 'js' ) && (node = createNode('script', { src: url }));
              (type === 'css') && (node = createNode('link', { rel: 'stylesheet', href: url }));
              if (node) {
                node.onload = (function(type, url) {
                  return function() {
                    end(type, url);
                  };
                })(type, url);
                (doc.head || doc.body).appendChild(node);
                s[url] = false;
              }
            }
          }
        }
      }
    };
    return {
      js: function(url, callback) {
        load('js', url, callback);
      },
      css: function(url, callback) {
        load('css', url, callback);
      }
    };
  })(this.document);
})();
</script><script>
  (function() {
    var TEXT_VARIABLES = {
      version: '2.2.6',
      sources: {
        font_awesome: '/assets/css/font-awesome-5.15.1-all.min.css',
        jquery: '/assets/js/jquery-3.6.0.min.js',
        leancloud_js_sdk: '//cdn.jsdelivr.net/npm/leancloud-storage@3.13.2/dist/av-min.js',
        chart: 'https://cdn.bootcss.com/Chart.js/2.7.2/Chart.bundle.min.js',
        gitalk: {
          js: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.js',
          css: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.css'
        },
        valine: 'https://unpkg.com/valine/dist/Valine.min.js',
        mathjax: 'https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML',
        mermaid: 'https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js'
      },
      site: {
        toc: {
          selectors: 'h1,h2,h3'
        }
      },
      paths: {
        search_js: '/assets/search.js'
      }
    };
    window.TEXT_VARIABLES = TEXT_VARIABLES;
  })();
</script>
<script>
  (function(h,o,u,n,d) {
    h=h[d]=h[d]||{q:[],onReady:function(c){h.q.push(c)}}
    d=o.createElement(u);d.async=1;d.src=n
    n=o.getElementsByTagName(u)[0];n.parentNode.insertBefore(d,n)
  })(window,document,'script','https://www.datadoghq-browser-agent.com/datadog-rum-v4.js','DD_RUM')
  DD_RUM.onReady(function() {
    DD_RUM.init({
      clientToken: 'pubcda42e398091be9674a1ef9abd156415',
      applicationId: '88839061-4ced-42cf-98c7-169c5e8ab6e4',
      site: 'datadoghq.eu',
      service: 'jingwen-z.github.io',
      env: 'prod',
      // Specify a version number to identify the deployed version of your application in Datadog
      // version: '1.0.0',
      sampleRate: 100,
      allowedTracingOrigins: ["https://search.jimidata.info"],
      trackInteractions: true,
      defaultPrivacyLevel: 'mask-user-input'
    });

    DD_RUM.startSessionReplayRecording();
  })
</script>
</head>
  <body>
    <div class="root" data-is-touch="false">
      <div class="layout--page js-page-root"><div class="page__main js-page-main page__viewport has-aside cell cell--auto">

      <div class="page__main-inner"><div class="page__header d-print-none"><header class="header"><div class="main">
      <div class="header__title">
        <div class="header__brand"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="24px" height="24px" viewBox="0 0 24 24">
<style type="text/css">
	.st0{fill:#515151;}
</style>
<path class="st0" d="M1.7,22.3c5.7-5.7,11.3-5.7,17,0c3.3-3.3,3.5-5.3,0.8-6c2.7,0.7,3.5-1.1,2.3-5.6s-3.3-5.2-6.3-2.1
	c3-3,2.3-5.2-2.1-6.3S7,1.8,7.7,4.6C7,1.8,5,2.1,1.7,5.3C7.3,11,7.3,16.7,1.7,22.3"/>
</svg>

          <a title="Data Science Enthusiast
" href="/">Jingwen Zheng</a>
        </div><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></div><nav class="navigation">
        <ul><li class="navigation__item"><a href="/portfolio">Portfolio</a></li><li class="navigation__item"><a href="/series">Series</a></li><li class="navigation__item"><a href="/archive">Archive</a></li><li class="navigation__item"><a href="/about">About</a></li><li><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></li></ul>
      </nav></div>
  </header>
</div><div class="page__content"><div class="article__header--overlay"><div class="hero hero--dark overlay" style="background-image:linear-gradient(135deg, rgba(0, 0, 0, .6), rgba(0, 0, 0, .4)),url(/images/20191108-header-img.jpg);background-color:#203028;"><div class="hero__content"><div class ="main"><div class="article__info clearfix">
      <ul class="left-col menu">
        <li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive?tag=python3">python3</a>
            </li><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive?tag=folium">folium</a>
            </li><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive?tag=geovisualisation">geovisualisation</a>
            </li>

      <li class="separator">|</li>
        
          <li>
            <a class="button button--circle button--primary focus lang"
               href="/how-to-draw-a-variety-of-maps-with-folium-in-python/"><span>EN</span></a>

            






            

            
          </li>
        
      
    </ul><ul class="right-col menu"><li><i class="far fa-calendar-alt"></i> <span>Nov 08, 2019</span>
            </li></ul></div><div class="article__header"><header><h1>How to draw a variety of maps with folium in python?</h1></header></div><p class="overlay__excerpt">This blog talks about how to draw a map with python module "folium", like how to display all locations with points or with cluster, how to paint areas with different colors, how to add labels or po...</p></div></div>
              </div>
            </div><div class ="main"><div class="grid grid--reverse">

              <div class="col-aside d-print-none js-col-aside"><aside class="page__aside js-page-aside"><div class="toc-aside js-toc-root"></div>
</aside></div>

              <div class="col-main cell cell--auto"><!-- start custom main top snippet -->

<!-- end custom main top snippet -->
<article itemscope itemtype="http://schema.org/Article"><meta itemprop="headline" content="How to draw a variety of maps with folium in python?"><meta itemprop="author" content="Jingwen Zheng"/><meta itemprop="datePublished" content="2019-11-08T20:55:41+01:00">
    <meta itemprop="keywords" content="python3,folium,geovisualisation"><div class="js-article-content"><div class="layout--article"><!-- start custom article top snippet -->

<!-- end custom article top snippet -->
<div class="article__content" itemprop="articleBody"><p>A map can clearly present information in terms of geography. Recently I learnt
how to realize geovisualization with <code class="language-plaintext highlighter-rouge">folium</code> module in Python. In this blog, I
will talk about how to draw a different types of map like with the following
points:</p>
<ul>
  <li>Datasets</li>
  <li>Display all locations with points on the map</li>
  <li>Display all locations with clusters</li>
  <li>Paint areas with different colors</li>
  <li>Add labels on the map</li>
  <li>Add polygon borders</li>
  <li>Show changes in terms of timing with heatmap</li>
  <li>Show changes in terms of timing with choropleth</li>
</ul>

<h2 id="datasets">Datasets</h2>
<p>Before drawing maps, I’ll talk about the datasets which are used for this blog.
I downloaded <a href="http://insideairbnb.com/get-the-data.html">Airbnb Paris’ datasets</a> “listings” and
“neighbourhoods”.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="n">gpd</span>

<span class="n">listing_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'listings.csv'</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s">'last_review'</span><span class="p">])</span>
<span class="n">nbh_geo_df</span> <span class="o">=</span> <span class="n">gpd</span><span class="p">.</span><span class="n">read_file</span><span class="p">(</span><span class="s">'neighbourhoods.geojson'</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s">'GeoJSON'</span><span class="p">)</span>
<span class="n">listing_df</span> <span class="o">=</span> <span class="n">listing_df</span><span class="p">[[</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'room_type'</span><span class="p">,</span> <span class="s">'neighbourhood'</span><span class="p">,</span>
                         <span class="s">'latitude'</span><span class="p">,</span> <span class="s">'longitude'</span><span class="p">,</span> <span class="s">'price'</span><span class="p">]]</span>
<span class="n">nbh_geo_df</span> <span class="o">=</span> <span class="n">nbh_geo_df</span><span class="p">[[</span><span class="s">'neighbourhood'</span><span class="p">,</span> <span class="s">'geometry'</span><span class="p">]]</span></code></pre></figure>

<p align="center">
  <img alt="Datasets" src="/images/20191108-datasets.png" />
</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span><span class="p">,</span> <span class="n">shape</span>

<span class="n">locs_geometry</span> <span class="o">=</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span> <span class="k">for</span> <span class="n">xy</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">listing_df</span><span class="p">.</span><span class="n">longitude</span><span class="p">,</span>
                                         <span class="n">listing_df</span><span class="p">.</span><span class="n">latitude</span><span class="p">)]</span>
<span class="n">crs</span> <span class="o">=</span> <span class="p">{</span><span class="s">'init'</span><span class="p">:</span> <span class="s">'epsg:4326'</span><span class="p">}</span>
<span class="c1"># Coordinate Reference Systems, "epsg:4326" is a common projection of WGS84 Latitude/Longitude
</span><span class="n">locs_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="p">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">listing_df</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">locs_geometry</span><span class="p">)</span></code></pre></figure>

<p>In order to put points on the map, we need to convert each coordinate to
geopoint, same for the dataframe.</p>

<h2 id="display-all-locations-with-points-on-the-map">Display all locations with points on the map</h2>

<p align="center">
  <img src="/images/20191108-locs-map.gif" style="max-width: 720px" alt="Display all locations with points on the map" />
</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">folium</span>
<span class="n">locs_map</span> <span class="o">=</span> <span class="n">folium</span><span class="p">.</span><span class="n">Map</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="mf">48.856614</span><span class="p">,</span> <span class="mf">2.3522219</span><span class="p">],</span>
                      <span class="n">zoom_start</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">tiles</span><span class="o">=</span><span class="s">'cartodbpositron'</span><span class="p">)</span>

<span class="n">feature_ea</span> <span class="o">=</span> <span class="n">folium</span><span class="p">.</span><span class="n">FeatureGroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'Entire home/apt'</span><span class="p">)</span>
<span class="n">feature_pr</span> <span class="o">=</span> <span class="n">folium</span><span class="p">.</span><span class="n">FeatureGroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'Private room'</span><span class="p">)</span>
<span class="n">feature_sr</span> <span class="o">=</span> <span class="n">folium</span><span class="p">.</span><span class="n">FeatureGroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'Shared room'</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">locs_gdf</span><span class="p">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">popup</span> <span class="o">=</span> <span class="s">"""
    Location id : &lt;b&gt;%s&lt;/b&gt;&lt;br&gt;
    Room type : &lt;b&gt;%s&lt;/b&gt;&lt;br&gt;
    Neighbourhood : &lt;b&gt;%s&lt;/b&gt;&lt;br&gt;
    Price : &lt;b&gt;%d&lt;/b&gt;&lt;br&gt;
    """</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s">'id'</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="s">'room_type'</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="s">'neighbourhood'</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="s">'price'</span><span class="p">])</span>
    
    <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s">'room_type'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'Entire home/apt'</span><span class="p">:</span>
        <span class="n">folium</span><span class="p">.</span><span class="n">CircleMarker</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s">'latitude'</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="s">'longitude'</span><span class="p">]],</span>
                            <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">tooltip</span><span class="o">=</span><span class="n">popup</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s">'#FFBA00'</span><span class="p">,</span>
                            <span class="n">fill_color</span><span class="o">=</span><span class="s">'#FFBA00'</span><span class="p">,</span>
                            <span class="n">fill</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">add_to</span><span class="p">(</span><span class="n">feature_ea</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">v</span><span class="p">[</span><span class="s">'room_type'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'Private room'</span><span class="p">:</span>
        <span class="n">folium</span><span class="p">.</span><span class="n">CircleMarker</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s">'latitude'</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="s">'longitude'</span><span class="p">]],</span>
                            <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">tooltip</span><span class="o">=</span><span class="n">popup</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s">'#087FBF'</span><span class="p">,</span>
                            <span class="n">fill_color</span><span class="o">=</span><span class="s">'#087FBF'</span><span class="p">,</span>
                            <span class="n">fill</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">add_to</span><span class="p">(</span><span class="n">feature_pr</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">v</span><span class="p">[</span><span class="s">'room_type'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'Shared room'</span><span class="p">:</span>
        <span class="n">folium</span><span class="p">.</span><span class="n">CircleMarker</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s">'latitude'</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="s">'longitude'</span><span class="p">]],</span>
                            <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">tooltip</span><span class="o">=</span><span class="n">popup</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s">'#FF0700'</span><span class="p">,</span>
                            <span class="n">fill_color</span><span class="o">=</span><span class="s">'#FF0700'</span><span class="p">,</span>
                            <span class="n">fill</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">add_to</span><span class="p">(</span><span class="n">feature_sr</span><span class="p">)</span>

<span class="n">feature_ea</span><span class="p">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">locs_map</span><span class="p">)</span>
<span class="n">feature_pr</span><span class="p">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">locs_map</span><span class="p">)</span>
<span class="n">feature_sr</span><span class="p">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">locs_map</span><span class="p">)</span>
<span class="n">folium</span><span class="p">.</span><span class="n">LayerControl</span><span class="p">(</span><span class="n">collapsed</span><span class="o">=</span><span class="bp">False</span><span class="p">).</span><span class="n">add_to</span><span class="p">(</span><span class="n">locs_map</span><span class="p">)</span></code></pre></figure>

<p>There are numerous marker types, I apply <code class="language-plaintext highlighter-rouge">CircleMarker</code> with a <code class="language-plaintext highlighter-rouge">popup</code>(input
text or visualization for object displayed when clicking) and <code class="language-plaintext highlighter-rouge">tooltip</code>(display
a text when hovering over the object), apply <code class="language-plaintext highlighter-rouge">LayerControl</code> to filter different
types of locations.</p>

<h2 id="display-all-locations-with-clusters">Display all locations with clusters</h2>

<p align="center">
  <img src="/images/20191108-cluster-map.gif" style="max-width: 720px" alt="Display all locations with clusters" />
</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">folium</span> <span class="kn">import</span> <span class="n">plugins</span>

<span class="n">cluster_map</span> <span class="o">=</span> <span class="n">folium</span><span class="p">.</span><span class="n">Map</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="mf">48.856614</span><span class="p">,</span> <span class="mf">2.3522219</span><span class="p">],</span>
                         <span class="n">zoom_start</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">tiles</span><span class="o">=</span><span class="s">'cartodbpositron'</span><span class="p">)</span>

<span class="n">marker_cluster</span> <span class="o">=</span> <span class="n">plugins</span><span class="p">.</span><span class="n">MarkerCluster</span><span class="p">().</span><span class="n">add_to</span><span class="p">(</span><span class="n">cluster_map</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">locs_gdf</span><span class="p">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">popup</span> <span class="o">=</span> <span class="s">"""
    Location id : &lt;b&gt;%s&lt;/b&gt;&lt;br&gt;
    Room type : &lt;b&gt;%s&lt;/b&gt;&lt;br&gt;
    Neighbourhood : &lt;b&gt;%s&lt;/b&gt;&lt;br&gt;
    Price : &lt;b&gt;%d&lt;/b&gt;&lt;br&gt;
    """</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s">'id'</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="s">'room_type'</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="s">'neighbourhood'</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="s">'price'</span><span class="p">])</span>
    
    <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s">'room_type'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'Entire home/apt'</span><span class="p">:</span>
        <span class="n">folium</span><span class="p">.</span><span class="n">CircleMarker</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s">'latitude'</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="s">'longitude'</span><span class="p">]],</span>
                            <span class="n">radius</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                            <span class="n">tooltip</span><span class="o">=</span><span class="n">popup</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s">'#FFBA00'</span><span class="p">,</span>
                            <span class="n">fill_color</span><span class="o">=</span><span class="s">'#FFBA00'</span><span class="p">,</span>
                            <span class="n">fill</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">add_to</span><span class="p">(</span><span class="n">marker_cluster</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">v</span><span class="p">[</span><span class="s">'room_type'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'Private room'</span><span class="p">:</span>
        <span class="n">folium</span><span class="p">.</span><span class="n">CircleMarker</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s">'latitude'</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="s">'longitude'</span><span class="p">]],</span>
                            <span class="n">radius</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                            <span class="n">tooltip</span><span class="o">=</span><span class="n">popup</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s">'#087FBF'</span><span class="p">,</span>
                            <span class="n">fill_color</span><span class="o">=</span><span class="s">'#087FBF'</span><span class="p">,</span>
                            <span class="n">fill</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">add_to</span><span class="p">(</span><span class="n">marker_cluster</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">v</span><span class="p">[</span><span class="s">'room_type'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'Shared room'</span><span class="p">:</span>
        <span class="n">folium</span><span class="p">.</span><span class="n">CircleMarker</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s">'latitude'</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="s">'longitude'</span><span class="p">]],</span>
                            <span class="n">radius</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                            <span class="n">tooltip</span><span class="o">=</span><span class="n">popup</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s">'#FF0700'</span><span class="p">,</span>
                            <span class="n">fill_color</span><span class="o">=</span><span class="s">'#FF0700'</span><span class="p">,</span>
                            <span class="n">fill</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">add_to</span><span class="p">(</span><span class="n">marker_cluster</span><span class="p">)</span></code></pre></figure>

<p>Before drawing <code class="language-plaintext highlighter-rouge">CircleMarker</code> on the map, I add <code class="language-plaintext highlighter-rouge">plugins.MarkerCluster()</code> on
the map for clustering coordinates.</p>

<h2 id="paint-areas-with-different-colors">Paint areas with different colors</h2>

<p align="center">
  <img src="/images/20191108-nbh-locs-map.gif" style="max-width: 720px" alt="Paint areas with different colors" />
</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">nbh_count_df</span> <span class="o">=</span> <span class="n">listing_df</span><span class="p">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'neighbourhood'</span><span class="p">)[</span><span class="s">'id'</span><span class="p">].</span><span class="n">nunique</span><span class="p">().</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">nbh_count_df</span><span class="p">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s">'id'</span><span class="p">:</span><span class="s">'nb'</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">nbh_geo_count_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">nbh_geo_df</span><span class="p">,</span> <span class="n">nbh_count_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s">'neighbourhood'</span><span class="p">)</span>
<span class="n">nbh_geo_count_df</span><span class="p">[</span><span class="s">'QP'</span><span class="p">]</span> <span class="o">=</span> <span class="n">nbh_geo_count_df</span><span class="p">[</span><span class="s">'nb'</span><span class="p">]</span> <span class="o">/</span> <span class="n">nbh_geo_count_df</span><span class="p">[</span><span class="s">'nb'</span><span class="p">].</span><span class="nb">sum</span><span class="p">()</span>
<span class="n">nbh_geo_count_df</span><span class="p">[</span><span class="s">'QP_str'</span><span class="p">]</span> <span class="o">=</span> <span class="n">nbh_geo_count_df</span><span class="p">[</span><span class="s">'QP'</span><span class="p">].</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="s">'%'</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">branca.colormap</span> <span class="kn">import</span> <span class="n">linear</span>
<span class="n">nbh_count_colormap</span> <span class="o">=</span> <span class="n">linear</span><span class="p">.</span><span class="n">YlGnBu_09</span><span class="p">.</span><span class="n">scale</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">nbh_count_df</span><span class="p">[</span><span class="s">'nb'</span><span class="p">]),</span>
                                            <span class="nb">max</span><span class="p">(</span><span class="n">nbh_count_df</span><span class="p">[</span><span class="s">'nb'</span><span class="p">]))</span>

<span class="n">nbh_locs_map</span> <span class="o">=</span> <span class="n">folium</span><span class="p">.</span><span class="n">Map</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="mf">48.856614</span><span class="p">,</span> <span class="mf">2.3522219</span><span class="p">],</span>
                          <span class="n">zoom_start</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="n">tiles</span><span class="o">=</span><span class="s">'cartodbpositron'</span><span class="p">)</span>

<span class="n">style_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">'fillColor'</span><span class="p">:</span> <span class="n">nbh_count_colormap</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s">'properties'</span><span class="p">][</span><span class="s">'nb'</span><span class="p">]),</span>
    <span class="s">'color'</span><span class="p">:</span> <span class="s">'black'</span><span class="p">,</span>
    <span class="s">'weight'</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span>
    <span class="s">'fillOpacity'</span><span class="p">:</span> <span class="mf">0.7</span>
<span class="p">}</span>

<span class="n">folium</span><span class="p">.</span><span class="n">GeoJson</span><span class="p">(</span>
    <span class="n">nbh_geo_count_df</span><span class="p">,</span>
    <span class="n">style_function</span><span class="o">=</span><span class="n">style_function</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="n">folium</span><span class="p">.</span><span class="n">GeoJsonTooltip</span><span class="p">(</span>
        <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s">'neighbourhood'</span><span class="p">,</span> <span class="s">'nb'</span><span class="p">,</span> <span class="s">'QP_str'</span><span class="p">],</span>
        <span class="n">aliases</span><span class="o">=</span><span class="p">[</span><span class="s">'Neighbourhood'</span><span class="p">,</span> <span class="s">'Location amount'</span><span class="p">,</span> <span class="s">'Quote-part'</span><span class="p">],</span>
        <span class="n">localize</span><span class="o">=</span><span class="bp">True</span>
    <span class="p">)</span>
<span class="p">).</span><span class="n">add_to</span><span class="p">(</span><span class="n">nbh_locs_map</span><span class="p">)</span>

<span class="n">nbh_count_colormap</span><span class="p">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">nbh_locs_map</span><span class="p">)</span>
<span class="n">nbh_count_colormap</span><span class="p">.</span><span class="n">caption</span> <span class="o">=</span> <span class="s">'Airbnb location amount'</span>
<span class="n">nbh_count_colormap</span><span class="p">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">nbh_locs_map</span><span class="p">)</span></code></pre></figure>

<p>To paint areas in terms of locations’ average price, we need to calculate the
values firstly. Then use <code class="language-plaintext highlighter-rouge">branca.colormap.linear</code> to set colormap, insert the
colormap into <code class="language-plaintext highlighter-rouge">style_function</code>, plot a GeoJSON overlay on the base map with
<code class="language-plaintext highlighter-rouge">folium.GeoJson</code>, then we can draw the map.</p>

<h2 id="add-labels-on-the-map">Add labels on the map</h2>

<p align="center">
  <img src="/images/20191108-nbh-locs-label-map.gif" style="max-width: 720px" alt="Add labels on the map" />
</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">nbh_locs_label_map</span> <span class="o">=</span> <span class="n">folium</span><span class="p">.</span><span class="n">Map</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="mf">48.856614</span><span class="p">,</span> <span class="mf">2.3522219</span><span class="p">],</span>
                                <span class="n">zoom_start</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="n">tiles</span><span class="o">=</span><span class="s">'cartodbpositron'</span><span class="p">)</span>

<span class="n">style_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">'fillColor'</span><span class="p">:</span> <span class="n">nbh_count_colormap</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s">'properties'</span><span class="p">][</span><span class="s">'nb'</span><span class="p">]),</span>
    <span class="s">'color'</span><span class="p">:</span> <span class="s">'black'</span><span class="p">,</span>
    <span class="s">'weight'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">'fillOpacity'</span><span class="p">:</span> <span class="mf">0.7</span>
<span class="p">}</span>

<span class="n">folium</span><span class="p">.</span><span class="n">GeoJson</span><span class="p">(</span>
    <span class="n">nbh_geo_count_df</span><span class="p">,</span>
    <span class="n">style_function</span><span class="o">=</span><span class="n">style_function</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="n">folium</span><span class="p">.</span><span class="n">GeoJsonTooltip</span><span class="p">(</span>
        <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s">'neighbourhood'</span><span class="p">,</span> <span class="s">'nb'</span><span class="p">,</span> <span class="s">'QP_str'</span><span class="p">],</span>
        <span class="n">aliases</span><span class="o">=</span><span class="p">[</span><span class="s">'Neighbourhood'</span><span class="p">,</span> <span class="s">'Location amount'</span><span class="p">,</span> <span class="s">'Quote-part'</span><span class="p">],</span>
        <span class="n">localize</span><span class="o">=</span><span class="bp">True</span>
    <span class="p">)</span>
<span class="p">).</span><span class="n">add_to</span><span class="p">(</span><span class="n">nbh_locs_label_map</span><span class="p">)</span>

<span class="n">folium</span><span class="p">.</span><span class="nb">map</span><span class="p">.</span><span class="n">CustomPane</span><span class="p">(</span><span class="s">'labels'</span><span class="p">).</span><span class="n">add_to</span><span class="p">(</span><span class="n">nbh_locs_label_map</span><span class="p">)</span>
<span class="n">folium</span><span class="p">.</span><span class="n">TileLayer</span><span class="p">(</span><span class="s">'CartoDBPositronOnlyLabels'</span><span class="p">,</span>
                 <span class="n">pane</span><span class="o">=</span><span class="s">'labels'</span><span class="p">).</span><span class="n">add_to</span><span class="p">(</span><span class="n">nbh_locs_label_map</span><span class="p">)</span></code></pre></figure>

<p>Do you notice that? The labels are usually covered by painted colors. In this
case, I used <code class="language-plaintext highlighter-rouge">folium.TileLayer</code> to add <code class="language-plaintext highlighter-rouge">CartoDBPositronOnlyLabels</code> on the map,
so that we add another labels’ layer.</p>

<h2 id="add-polygon-borders">Add polygon borders</h2>

<p align="center">
  <img alt="Add polygon borders" src="/images/20191108-polygon-map.png" />
</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">dept_geo</span> <span class="o">=</span> <span class="n">gpd</span><span class="p">.</span><span class="n">read_file</span><span class="p">(</span><span class="s">'departements.geojson'</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s">'GeoJSON'</span><span class="p">)</span>
<span class="n">departments</span> <span class="o">=</span> <span class="p">{</span><span class="s">'75'</span><span class="p">,</span> <span class="s">'77'</span><span class="p">,</span> <span class="s">'78'</span><span class="p">,</span> <span class="s">'91'</span><span class="p">,</span> <span class="s">'92'</span><span class="p">,</span> <span class="s">'93'</span><span class="p">,</span> <span class="s">'94'</span><span class="p">,</span> <span class="s">'95'</span><span class="p">}</span>
<span class="n">dept_geo</span> <span class="o">=</span> <span class="n">dept_geo</span><span class="p">[</span><span class="n">dept_geo</span><span class="p">[</span><span class="s">'code'</span><span class="p">].</span><span class="n">isin</span><span class="p">(</span><span class="n">departments</span><span class="p">)]</span>

<span class="n">polygon_map</span> <span class="o">=</span> <span class="n">folium</span><span class="p">.</span><span class="n">Map</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="mf">48.716614</span><span class="p">,</span> <span class="mf">2.3522219</span><span class="p">],</span>
                         <span class="n">zoom_start</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span> <span class="n">tiles</span><span class="o">=</span><span class="s">'cartodbpositron'</span><span class="p">)</span>

<span class="n">style_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">'fillColor'</span><span class="p">:</span> <span class="n">nbh_count_colormap</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s">'properties'</span><span class="p">][</span><span class="s">'nb'</span><span class="p">]),</span>
    <span class="s">'color'</span><span class="p">:</span> <span class="s">'black'</span><span class="p">,</span>
    <span class="s">'weight'</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span>
    <span class="s">'fillOpacity'</span><span class="p">:</span> <span class="mf">0.7</span>
<span class="p">}</span>

<span class="n">folium</span><span class="p">.</span><span class="n">GeoJson</span><span class="p">(</span>
    <span class="n">nbh_geo_count_df</span><span class="p">,</span>
    <span class="n">style_function</span><span class="o">=</span><span class="n">style_function</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="n">folium</span><span class="p">.</span><span class="n">GeoJsonTooltip</span><span class="p">(</span>
        <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s">'neighbourhood'</span><span class="p">,</span> <span class="s">'nb'</span><span class="p">,</span> <span class="s">'QP_str'</span><span class="p">],</span>
        <span class="n">aliases</span><span class="o">=</span><span class="p">[</span><span class="s">'Neighbourhood'</span><span class="p">,</span> <span class="s">'Location amount'</span><span class="p">,</span> <span class="s">'Quote-part'</span><span class="p">],</span>
        <span class="n">localize</span><span class="o">=</span><span class="bp">True</span>
    <span class="p">)</span>
<span class="p">).</span><span class="n">add_to</span><span class="p">(</span><span class="n">polygon_map</span><span class="p">)</span>

<span class="n">folium</span><span class="p">.</span><span class="n">GeoJson</span><span class="p">(</span>
    <span class="n">dept_geo</span><span class="p">,</span>
    <span class="n">style_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">'color'</span><span class="p">:</span> <span class="s">'black'</span><span class="p">,</span>
        <span class="s">'weight'</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span>
        <span class="s">'fillOpacity'</span><span class="p">:</span> <span class="mi">0</span>
    <span class="p">},</span>
    <span class="n">name</span><span class="o">=</span><span class="s">'Departement'</span><span class="p">).</span><span class="n">add_to</span><span class="p">(</span><span class="n">polygon_map</span><span class="p">)</span>

<span class="n">nbh_count_colormap</span><span class="p">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">polygon_map</span><span class="p">)</span>
<span class="n">nbh_count_colormap</span><span class="p">.</span><span class="n">caption</span> <span class="o">=</span> <span class="s">'Airbnb location amount'</span>
<span class="n">nbh_count_colormap</span><span class="p">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">polygon_map</span><span class="p">)</span></code></pre></figure>

<p>I downloaded Ile-de-France’s geojson data from <a href="https://github.com/gregoiredavid/france-geojson">here</a>. To draw
polygons’ border, the only thing that we need to do is add the polygons’
coordinates and set <code class="language-plaintext highlighter-rouge">fillOpacity</code> to be 0.</p>

<h2 id="show-changes-in-terms-of-timing-with-heatmap">Show changes in terms of timing with heatmap</h2>

<p align="center">
  <img src="/images/20191108-location-history.gif" style="max-width: 720px" alt="Changes in terms of timing with heatmap" />
</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">date_index</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">'%Y-%m-%d'</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">listing_summary_history</span><span class="p">.</span><span class="n">date_of_data</span><span class="p">.</span><span class="n">unique</span><span class="p">()][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">locs_history_map</span> <span class="o">=</span> <span class="n">folium</span><span class="p">.</span><span class="n">Map</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="mf">48.856614</span><span class="p">,</span> <span class="mf">2.3522219</span><span class="p">],</span>
                              <span class="n">zoom_start</span> <span class="o">=</span> <span class="mi">13</span><span class="p">,</span> <span class="n">tiles</span><span class="o">=</span><span class="s">'cartodbpositron'</span><span class="p">)</span>

<span class="n">hm</span> <span class="o">=</span> <span class="n">plugins</span><span class="p">.</span><span class="n">HeatMapWithTime</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">locs_yearly</span><span class="p">,</span>
    <span class="n">index</span><span class="o">=</span><span class="n">date_index</span><span class="p">,</span>
    <span class="n">auto_play</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">radius</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">max_opacity</span><span class="o">=</span><span class="mf">0.3</span>
<span class="p">)</span>

<span class="n">hm</span><span class="p">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">locs_history_map</span><span class="p">)</span></code></pre></figure>

<p>For presenting the changes in terms of time on a heatmap, we can apply
<code class="language-plaintext highlighter-rouge">plugins.HeatMapWithTime()</code>. <code class="language-plaintext highlighter-rouge">data</code> is the points you want to plot, which is a
list of list of points of the form [lat, lng] or [lat, lng, weight]. <code class="language-plaintext highlighter-rouge">index</code>
gives the label (or timestamp) of the elements of data, should be the same
length as data, or is replaced by a simple count if not specified.</p>

<h2 id="show-changes-in-terms-of-timing-with-choropleth">Show changes in terms of timing with choropleth</h2>

<p align="center">
  <img src="/images/20191108-neighbourhood-locations-price-history.gif" style="max-width: 720px" alt="Changes in terms of timing with choropleth" />
</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">nbh_locsNb_history</span> <span class="o">=</span> <span class="n">listing_summary_history</span><span class="p">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">'date_of_data'</span><span class="p">,</span>
                                                      <span class="s">'neighbourhood'</span><span class="p">])[</span><span class="s">'id'</span><span class="p">].</span><span class="n">nunique</span><span class="p">().</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">nbh_locsNb_history</span><span class="p">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s">'id'</span><span class="p">:</span><span class="s">'nb'</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">nbh_locsNb_history</span><span class="p">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s">'neighbourhood'</span><span class="p">,</span> <span class="s">'date_of_data'</span><span class="p">],</span>
                               <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">nbh_locsNb_history</span><span class="p">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">nbh_geo_sorted_df</span> <span class="o">=</span> <span class="n">nbh_geo_df</span><span class="p">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s">'neighbourhood'</span><span class="p">).</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></code></pre></figure>

<p>The map above describes the price’s changes of each neighbourhood in terms of
time series. Thus, before making the map, we need to calculate the average
location’s price for each neighbourhood each year.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">datetime_index</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">nbh_locsNb_history</span><span class="p">.</span><span class="n">date_of_data</span><span class="p">.</span><span class="n">unique</span><span class="p">())</span>
<span class="n">dt_index_epochs</span> <span class="o">=</span> <span class="n">datetime_index</span><span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">//</span> <span class="mi">10</span><span class="o">**</span><span class="mi">9</span>
<span class="n">dt_index</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">dt_index_epochs</span><span class="p">).</span><span class="n">astype</span><span class="p">(</span><span class="s">'U10'</span><span class="p">)</span></code></pre></figure>

<p>Then I prepared convert datetime to <code class="language-plaintext highlighter-rouge">U10</code> with <code class="language-plaintext highlighter-rouge">pandas.DatetimeIndex()</code> and
<code class="language-plaintext highlighter-rouge">astype()</code>.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">styledata</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">e</span> <span class="o">=</span> <span class="mi">44</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">nbh_geo_sorted_190709</span><span class="p">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span><span class="s">'color'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">nbh_locsNb_history</span><span class="p">.</span><span class="n">nb</span><span class="p">[</span><span class="n">s</span><span class="p">:</span><span class="n">e</span><span class="p">]),</span>
         <span class="s">'opacity'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">44</span><span class="p">)},</span>
        <span class="n">index</span><span class="o">=</span><span class="n">dt_index</span>
    <span class="p">)</span>
    <span class="n">styledata</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="mi">44</span>
    <span class="n">e</span> <span class="o">+=</span> <span class="mi">44</span>

<span class="n">max_color</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nbh_locsNb_history</span><span class="p">[</span><span class="s">'nb'</span><span class="p">])</span>
<span class="n">min_color</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nbh_locsNb_history</span><span class="p">[</span><span class="s">'nb'</span><span class="p">])</span>
<span class="n">max_opacity</span><span class="p">,</span> <span class="n">min_opacity</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>

<span class="n">cmap</span> <span class="o">=</span> <span class="n">linear</span><span class="p">.</span><span class="n">YlGnBu_09</span><span class="p">.</span><span class="n">scale</span><span class="p">(</span><span class="n">min_color</span><span class="p">,</span> <span class="n">max_color</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">norm</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="p">.</span><span class="nb">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nb">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">x</span><span class="p">.</span><span class="nb">min</span><span class="p">())</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">styledata</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">data</span><span class="p">[</span><span class="s">'color'</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'color'</span><span class="p">].</span><span class="nb">map</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[</span><span class="s">'opacity'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">styledict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">nbh</span><span class="p">):</span> <span class="n">data</span><span class="p">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s">'index'</span><span class="p">)</span> <span class="k">for</span> <span class="n">nbh</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">styledata</span><span class="p">.</span><span class="n">items</span><span class="p">()</span>
<span class="p">}</span></code></pre></figure>

<p>The last step is to define a color map in terms of neighbourhoods’ prices for
each year.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">folium.plugins</span> <span class="kn">import</span> <span class="n">TimeSliderChoropleth</span>

<span class="n">nbh_locs_history_map</span> <span class="o">=</span> <span class="n">folium</span><span class="p">.</span><span class="n">Map</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="mf">48.856614</span><span class="p">,</span> <span class="mf">2.3522219</span><span class="p">],</span>
                                  <span class="n">zoom_start</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="n">tiles</span><span class="o">=</span><span class="s">'cartodbpositron'</span><span class="p">)</span>

<span class="n">TimeSliderChoropleth</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">nbh_geo_sorted_190709</span><span class="p">.</span><span class="n">to_json</span><span class="p">(),</span>
    <span class="n">styledict</span><span class="o">=</span><span class="n">styledict</span>
<span class="p">).</span><span class="n">add_to</span><span class="p">(</span><span class="n">nbh_locs_history_map</span><span class="p">)</span></code></pre></figure>

<p>We can apply <code class="language-plaintext highlighter-rouge">TimeSliderChoropleth</code> to draw the time series map. <code class="language-plaintext highlighter-rouge">data</code> should
be geojson string, <code class="language-plaintext highlighter-rouge">styledict</code> is the dictionary where the keys are the geojson
feature ids and the values are dicts of {time: style_options_dict}.</p>

<h2 id="reference">Reference</h2>
<ul>
  <li>“Inside Airbnb”, <em>insideairbnb.com</em>. [Online]. Available: <a href="http://insideairbnb.com/get-the-data.html">http://insideairbnb.com/get-the-data.html</a></li>
  <li>Grégoire David, “france-geojson”, <em>github.com</em>. [Online]. Available: <a href="https://github.com/gregoiredavid/france-geojson">https://github.com/gregoiredavid/france-geojson</a></li>
  <li>“Popups”, <em>jupyter.org</em>. [Online]. Available: <a href="https://nbviewer.jupyter.org/github/python-visualization/folium/blob/master/examples/Popups.ipynb">https://nbviewer.jupyter.org/github/python-visualization/folium/blob/master/examples/Popups.ipynb</a></li>
  <li>“MarkerCluster”, <em>jupyter.org</em>. [Online]. Available: <a href="https://nbviewer.jupyter.org/github/python-visualization/folium/blob/master/examples/MarkerCluster.ipynb">https://nbviewer.jupyter.org/github/python-visualization/folium/blob/master/examples/MarkerCluster.ipynb</a></li>
  <li>“Colormaps”, <em>jupyter.org</em>. [Online]. Available: <a href="https://nbviewer.jupyter.org/github/python-visualization/folium/blob/master/examples/Colormaps.ipynb">https://nbviewer.jupyter.org/github/python-visualization/folium/blob/master/examples/Colormaps.ipynb</a></li>
  <li>“CustomPanes”, <em>jupyter.org</em>. [Online]. Available: <a href="https://nbviewer.jupyter.org/github/python-visualization/folium/blob/master/examples/CustomPanes.ipynb">https://nbviewer.jupyter.org/github/python-visualization/folium/blob/master/examples/CustomPanes.ipynb</a></li>
  <li>“GeoJSON_and_choropleth”, <em>jupyter.org</em>. [Online]. Available: [https://nbviewer.jupyter.org/github/python-visualization/folium/blob/master/examples/GeoJSON_and_choropleth.ipynb[<a href="https://nbviewer.jupyter.org/github/python-visualization/folium/blob/master/examples/GeoJSON_and_choropleth.ipynb">GeoJSON_and_choropleth</a></li>
  <li>“HeatMapWithTime”, <em>jupyter.org</em>. [Online]. Available: <a href="https://nbviewer.jupyter.org/github/python-visualization/folium/blob/master/examples/HeatMapWithTime.ipynb">https://nbviewer.jupyter.org/github/python-visualization/folium/blob/master/examples/HeatMapWithTime.ipynb</a></li>
  <li>“TimeSliderChoropleth”, <em>jupyter.org</em>. [Online]. Available: <a href="https://nbviewer.jupyter.org/github/python-visualization/folium/blob/master/examples/TimeSliderChoropleth.ipynb">https://nbviewer.jupyter.org/github/python-visualization/folium/blob/master/examples/TimeSliderChoropleth.ipynb</a></li>
  <li>WikiImages, “Earth map summer July continents”, pixabay.com_. [Online]. Available: <a href="https://pixabay.com/photos/earth-map-summer-july-continents-11048/">https://pixabay.com/photos/earth-map-summer-july-continents-11048/</a></li>
</ul>

</div><section class="article__sharing d-print-none"></section><div class="d-print-none"><footer class="article__footer"><meta itemprop="dateModified" content="2019-11-08T20:55:41+01:00"><!-- start custom article footer snippet -->

<!-- end custom article footer snippet -->
<div class="article__subscribe"><div class="subscribe"><i class="fas fa-rss"></i> <a type="application/rss+xml" href="/feed.xml">Subscribe</a></div></div><div class="article__license"><div class="license">
    <p>This work is licensed under a <a itemprop="license" rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">Attribution-NonCommercial 4.0 International</a> license.
      <a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">
        <img alt="Attribution-NonCommercial 4.0 International" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" />
      </a>
    </p>
  </div></div></footer>
<div class="article__section-navigator clearfix"><div class="previous"><span>PREVIOUS</span><a href="/how-to-draw-a-map-with-folium-module-in-python/">How to draw a map with folium module in Python?</a></div><div class="next"><span>NEXT</span><a href="/older-apartments-transactions-in-paris/">Second-hand apartments transactions in Paris</a></div></div></div>

</div>

<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    $(function() {
      var $this ,$scroll;
      var $articleContent = $('.js-article-content');
      var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
      var scroll = hasSidebar ? '.js-page-main' : 'html, body';
      $scroll = $(scroll);

      $articleContent.find('.highlight').each(function() {
        $this = $(this);
        $this.attr('data-lang', $this.find('code').attr('data-lang'));
      });
      $articleContent.find('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]').each(function() {
        $this = $(this);
        $this.append($('<a class="anchor d-print-none" aria-hidden="true"></a>').html('<i class="fas fa-anchor"></i>'));
      });
      $articleContent.on('click', '.anchor', function() {
        $scroll.scrollToAnchor('#' + $(this).parent().attr('id'), 400);
      });
    });
  });
})();
</script>
</div><section class="page__comments d-print-none"><div id="disqus_thread"></div>
  <script>
  /**
  *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
  *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
  var disqus_config = function () {
    this.page.url = 'https://jingwen-z.github.io/how-to-draw-a-variety-of-maps-with-folium-in-python/';
    this.page.identifier = '/how-to-draw-a-variety-of-maps-with-folium-in-python';
  };
  (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://jingwen-z.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></section></article><!-- start custom main bottom snippet -->

<!-- end custom main bottom snippet -->
</div>
            </div></div></div><div class="page__footer d-print-none">
<footer class="footer py-4 js-page-footer">
  <div class="main"><div itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jingwen Zheng"><meta itemprop="url" content="/"><meta itemprop="description" content="Data Science Enthusiast"><div class="footer__author-links"><div class="author-links">
  <ul class="menu menu--nowrap menu--inline"><li title="Follow me on Linkedin.">
        <a class="button button--circle linkedin-button" itemprop="sameAs" href="https://www.linkedin.com/in/jingwen-zheng" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M260.096 155.648c0 27.307008-9.899008 50.516992-29.696 69.632-19.796992 19.115008-45.396992 28.672-76.8 28.672-30.036992 0-54.612992-9.556992-73.728-28.672-19.115008-19.115008-28.672-42.324992-28.672-69.632 0-28.672 9.556992-52.224 28.672-70.656 19.115008-18.432 44.372992-27.648 75.776-27.648 31.403008 0 56.32 9.216 74.752 27.648 18.432 18.432 28.331008 41.984 29.696 70.656 0 0 0 0 0 0m-202.752 808.96c0 0 0-632.832 0-632.832 0 0 196.608 0 196.608 0 0 0 0 632.832 0 632.832 0 0-196.608 0-196.608 0 0 0 0 0 0 0m313.344-430.08c0-58.708992-1.364992-126.292992-4.096-202.752 0 0 169.984 0 169.984 0 0 0 10.24 88.064 10.24 88.064 0 0 4.096 0 4.096 0 40.96-68.267008 105.812992-102.4 194.56-102.4 68.267008 0 123.220992 22.868992 164.864 68.608 41.643008 45.739008 62.464 113.664 62.464 203.776 0 0 0 374.784 0 374.784 0 0-196.608 0-196.608 0 0 0 0-350.208 0-350.208 0-91.476992-33.451008-137.216-100.352-137.216-47.787008 0-81.236992 24.576-100.352 73.728-4.096 8.192-6.144 24.576-6.144 49.152 0 0 0 364.544 0 364.544 0 0-198.656 0-198.656 0 0 0 0-430.08 0-430.08 0 0 0 0 0 0" />
</svg>
</div>
        </a>
      </li><li title="Follow me on Github.">
        <a class="button button--circle github-button" itemprop="sameAs" href="https://github.com/jingwen-z" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path class="svgpath" data-index="path_0" fill="#272636" d="M0 525.2c0 223.6 143.3 413.7 343 483.5 26.9 6.8 22.8-12.4 22.8-25.4l0-88.7c-155.3 18.2-161.5-84.6-172-101.7-21.1-36-70.8-45.2-56-62.3 35.4-18.2 71.4 4.6 113.1 66.3 30.2 44.7 89.1 37.2 119 29.7 6.5-26.9 20.5-50.9 39.7-69.6C248.8 728.2 181.7 630 181.7 513.2c0-56.6 18.7-108.7 55.3-150.7-23.3-69.3 2.2-128.5 5.6-137.3 66.5-6 135.5 47.6 140.9 51.8 37.8-10.2 80.9-15.6 129.1-15.6 48.5 0 91.8 5.6 129.8 15.9 12.9-9.8 77-55.8 138.8-50.2 3.3 8.8 28.2 66.7 6.3 135 37.1 42.1 56 94.6 56 151.4 0 117-67.5 215.3-228.8 243.7 26.9 26.6 43.6 63.4 43.6 104.2l0 128.8c0.9 10.3 0 20.5 17.2 20.5C878.1 942.4 1024 750.9 1024 525.3c0-282.9-229.3-512-512-512C229.1 13.2 0 242.3 0 525.2L0 525.2z" />
</svg>
</div>
        </a>
      </li></ul>
</div>
</div>
    </div><div class="site-info mt-2">
      <div>© Jingwen Zheng 2021,
        Powered by <a title="Jekyll is a simple, blog-aware, static site generator." href="http://jekyllrb.com/">Jekyll</a> & <a
        title="TeXt is a super customizable Jekyll theme." href="https://github.com/kitian616/jekyll-TeXt-theme">TeXt Theme</a>.
      </div>
    </div>
  </div>
</footer>
</div></div>
    </div><script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $body = $('body'), $window = $(window);
    var $pageRoot = $('.js-page-root'), $pageMain = $('.js-page-main');
    var activeCount = 0;
    function modal(options) {
      var $root = this, visible, onChange, hideWhenWindowScroll = false;
      var scrollTop;
      function setOptions(options) {
        var _options = options || {};
        visible = _options.initialVisible === undefined ? false : show;
        onChange = _options.onChange;
        hideWhenWindowScroll = _options.hideWhenWindowScroll;
      }
      function init() {
        setState(visible);
      }
      function setState(isShow) {
        if (isShow === visible) {
          return;
        }
        visible = isShow;
        if (visible) {
          activeCount++;
          scrollTop = $(window).scrollTop() || $pageMain.scrollTop();
          $root.addClass('modal--show');
          $pageMain.scrollTop(scrollTop);
          activeCount === 1 && ($pageRoot.addClass('show-modal'), $body.addClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.on('scroll', hide);
          $window.on('keyup', handleKeyup);
        } else {
          activeCount > 0 && activeCount--;
          $root.removeClass('modal--show');
          $window.scrollTop(scrollTop);
          activeCount === 0 && ($pageRoot.removeClass('show-modal'), $body.removeClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.off('scroll', hide);
          $window.off('keyup', handleKeyup);
        }
        onChange && onChange(visible);
      }
      function show() {
        setState(true);
      }
      function hide() {
        setState(false);
      }
      function handleKeyup(e) {
        // Char Code: 27  ESC
        if (e.which ===  27) {
          hide();
        }
      }
      setOptions(options);
      init();
      return {
        show: show,
        hide: hide,
        $el: $root
      };
    }
    $.fn.modal = modal;
  });
})();
</script><div class="modal modal--overflow page__search-modal d-print-none js-page-search-modal"><script>
(function () {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    // search panel
    var search = (window.search || (window.search = {}));
    var useDefaultSearchBox = window.useDefaultSearchBox === undefined ?
      true : window.useDefaultSearchBox ;

    var $searchModal = $('.js-page-search-modal');
    var $searchToggle = $('.js-search-toggle');
    var searchModal = $searchModal.modal({ onChange: handleModalChange, hideWhenWindowScroll: true });
    var modalVisible = false;
    search.searchModal = searchModal;

    var $searchBox = null;
    var $searchInput = null;
    var $searchClear = null;

    function getModalVisible() {
      return modalVisible;
    }
    search.getModalVisible = getModalVisible;

    function handleModalChange(visible) {
      modalVisible = visible;
      if (visible) {
        search.onShow && search.onShow();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].focus();
      } else {
        search.onShow && search.onHide();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].blur();
        setTimeout(function() {
          useDefaultSearchBox && ($searchInput.val(''), $searchBox.removeClass('not-empty'));
          search.clear && search.clear();
          window.pageAsideAffix && window.pageAsideAffix.refresh();
        }, 400);
      }
    }

    $searchToggle.on('click', function() {
      modalVisible ? searchModal.hide() : searchModal.show();
    });
    // Char Code: 83  S, 191 /
    $(window).on('keyup', function(e) {
      if (!modalVisible && !window.isFormElement(e.target || e.srcElement) && (e.which === 83 || e.which === 191)) {
        modalVisible || searchModal.show();
      }
    });

    if (useDefaultSearchBox) {
      $searchBox = $('.js-search-box');
      $searchInput = $searchBox.children('input');
      $searchClear = $searchBox.children('.js-icon-clear');
      search.getSearchInput = function() {
        return $searchInput.get(0);
      };
      search.getVal = function() {
        return $searchInput.val();
      };
      search.setVal = function(val) {
        $searchInput.val(val);
      };

      $searchInput.on('focus', function() {
        $(this).addClass('focus');
      });
      $searchInput.on('blur', function() {
        $(this).removeClass('focus');
      });
      $searchInput.on('input', window.throttle(function() {
        var val = $(this).val();
        if (val === '' || typeof val !== 'string') {
          search.clear && search.clear();
        } else {
          $searchBox.addClass('not-empty');
          search.onInputNotEmpty && search.onInputNotEmpty(val);
        }
      }, 400));
      $searchClear.on('click', function() {
        $searchInput.val(''); $searchBox.removeClass('not-empty');
        search.clear && search.clear();
      });
    }
  });
})();
</script><div class="search search--dark">
  <div class="main">
    <div class="search__header">Search</div>
    <div class="search-bar">
      <div class="search-box js-search-box">
        <div class="search-box__icon-search"><i class="fas fa-search"></i></div>
        <input type="text" />
        <div class="search-box__icon-clear js-icon-clear">
          <a><i class="fas fa-times"></i></a>
        </div>
      </div>
      <button class="button button--theme-dark button--pill search__cancel js-search-toggle">
        Cancel</button>
    </div>
    <div class="search-result js-search-result"></div>
  </div>
</div>
<script>var SOURCES = window.TEXT_VARIABLES.sources;
var PAHTS = window.TEXT_VARIABLES.paths;
window.Lazyload.js([SOURCES.jquery, PAHTS.search_js], function() {
  var search = (window.search || (window.search = {}));
  var searchData = window.TEXT_SEARCH_DATA || {};

  function memorize(f) {
    var cache = {};
    return function () {
      var key = Array.prototype.join.call(arguments, ',');
      if (key in cache) return cache[key];
      else return cache[key] = f.apply(this, arguments);
    };
  }

  // search
  function searchByQuery(query) {
    var i, j, key, keys, cur, _title, result = {};
    keys = Object.keys(searchData);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      for (j = 0; j < searchData[key].length; j++) {
        cur = searchData[key][j], _title = cur.title;
        if ((result[key] === undefined || result[key] && result[key].length < 4 )
          && _title.toLowerCase().indexOf(query.toLowerCase()) >= 0) {
          if (result[key] === undefined) {
            result[key] = [];
          }
          result[key].push(cur);
        }
      }
    }
    return result;
  }

  // search
  function remoteSearchByQuery(query) {
    console.log(`searching: ${query}`);
    var i, j, key, keys, cur, _title;
    const url = 'https://search.jimidata.info/sites/jingwen-z.github.io/posts/search?' + $.param({
      q: query
    });
    let start = Date.now();
    $.ajax({
      'url': url,
      'success': function(data) {
        let duration = Date.now() - start;
        console.log(`received response successfully (${duration} ms)`);

        result = {};
        keys = Object.keys(data);

        for (i = 0; i < keys.length; i++) {
          key = keys[i];
          for (j = 0; j < data[key].length; j++) {
            cur = data[key][j], _title = cur.title;
            if ((result[key] === undefined || result[key] && result[key].length < 4 )
              && _title.toLowerCase().indexOf(query.toLowerCase()) >= 0) {
              if (result[key] === undefined) {
                result[key] = [];
              }
              result[key].push(cur);
            }
          }
        }

        $('.js-search-result').html(render(data));
        $resultItems = $('.search-result__item');
        activeIndex = 0;
        $resultItems.eq(0).addClass('active');
      },
      'error': function(data) {
        let duration = Date.now() - start;
        console.error(`received error response (${duration} ms)`);
        console.error(data);
      }
    })
  }

  var renderHeader = memorize(function(header) {
    return $('<p class="search-result__header">' + header + '</p>');
  });

  var renderItem = function(index, title, url) {
    return $('<li class="search-result__item" data-index="' + index + '"><a class="button" href="' + url + '">' + title + '</a></li>');
  };

  function render(data) {
    if (!data) { return null; }
    var $root = $('<ul></ul>'), i, j, key, keys, cur, itemIndex = 0;
    keys = Object.keys(data);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      $root.append(renderHeader(key));
      for (j = 0; j < data[key].length; j++) {
        cur = data[key][j];
        $root.append(renderItem(itemIndex++, cur.title, cur.url));
      }
    }
    return $root;
  }

  // search box
  var $result = $('.js-search-result'), $resultItems;
  var lastActiveIndex, activeIndex;

  function clear() {
    $result.html(null);
    $resultItems = $('.search-result__item'); activeIndex = 0;
  }

  function onInputNotEmpty(val) {
    remoteSearchByQuery(val);
  }

  search.clear = clear;
  search.onInputNotEmpty = onInputNotEmpty;

  function updateResultItems() {
    lastActiveIndex >= 0 && $resultItems.eq(lastActiveIndex).removeClass('active');
    activeIndex >= 0 && $resultItems.eq(activeIndex).addClass('active');
  }

  function moveActiveIndex(direction) {
    var itemsCount = $resultItems ? $resultItems.length : 0;
    if (itemsCount > 1) {
      lastActiveIndex = activeIndex;
      if (direction === 'up') {
        activeIndex = (activeIndex - 1 + itemsCount) % itemsCount;
      } else if (direction === 'down') {
        activeIndex = (activeIndex + 1 + itemsCount) % itemsCount;
      }
      updateResultItems();
    }
  }

  // Char Code: 13  Enter, 37  ⬅, 38  ⬆, 39  ➡, 40  ⬇
  $(window).on('keyup', function(e) {
    var modalVisible = search.getModalVisible && search.getModalVisible();
    if (modalVisible) {
      if (e.which === 38) {
        modalVisible && moveActiveIndex('up');
      } else if (e.which === 40) {
        modalVisible && moveActiveIndex('down');
      } else if (e.which === 13) {
        modalVisible && $resultItems && activeIndex >= 0 && $resultItems.eq(activeIndex).children('a')[0].click();
      }
    }
  });

  $result.on('mouseover', '.search-result__item > a', function() {
    var itemIndex = $(this).parent().data('index');
    itemIndex >= 0 && (lastActiveIndex = activeIndex, activeIndex = itemIndex, updateResultItems());
  });
});
</script>
</div></div>


<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function scrollToAnchor(anchor, duration, callback) {
      var $root = this;
      $root.animate({ scrollTop: $(anchor).position().top }, duration, function() {
        window.history.replaceState(null, '', window.location.href.split('#')[0] + anchor);
        callback && callback();
      });
    }
    $.fn.scrollToAnchor = scrollToAnchor;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function affix(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroll,
        offsetBottom = 0, scrollTarget = window, scroll = window.document, disabled = false, isOverallScroller = true,
        rootTop, rootLeft, rootHeight, scrollBottom, rootBottomTop,
        hasInit = false, curState;

      function setOptions(options) {
        var _options = options || {};
        _options.offsetBottom && (offsetBottom = _options.offsetBottom);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroll && (scroll = _options.scroll);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $scrollTarget = $(scrollTarget);
        isOverallScroller = window.isOverallScroller($scrollTarget[0]);
        $scroll = $(scroll);
      }
      function preCalc() {
        top();
        rootHeight = $root.outerHeight();
        rootTop = $root.offset().top + (isOverallScroller ? 0 :  $scrollTarget.scrollTop());
        rootLeft = $root.offset().left;
      }
      function calc(needPreCalc) {
        needPreCalc && preCalc();
        scrollBottom = $scroll.outerHeight() - offsetBottom - rootHeight;
        rootBottomTop = scrollBottom - rootTop;
      }
      function top() {
        if (curState !== 'top') {
          $root.removeClass('fixed').css({
            left: 0,
            top: 0
          });
          curState = 'top';
        }
      }
      function fixed() {
        if (curState !== 'fixed') {
          $root.addClass('fixed').css({
            left: rootLeft + 'px',
            top: 0
          });
          curState = 'fixed';
        }
      }
      function bottom() {
        if (curState !== 'bottom') {
          $root.removeClass('fixed').css({
            left: 0,
            top: rootBottomTop + 'px'
          });
          curState = 'bottom';
        }
      }
      function setState() {
        var scrollTop = $scrollTarget.scrollTop();
        if (scrollTop >= rootTop && scrollTop <= scrollBottom) {
          fixed();
        } else if (scrollTop < rootTop) {
          top();
        } else {
          bottom();
        }
      }
      function init() {
        if(!hasInit) {
          var interval, timeout;
          calc(true); setState();
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState();
          });
          $window.on('resize', function() {
            disabled || (calc(true), setState());
          });
          hasInit = true;
        }
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions,
        refresh: function() {
          calc(true, { animation: false }); setState();
        }
      };
    }
    $.fn.affix = affix;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function toc(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroller, $tocUl = $('<ul class="toc toc--ellipsis"></ul>'), $tocLi, $headings, $activeLast, $activeCur,
        selectors = 'h1,h2,h3', container = 'body', scrollTarget = window, scroller = 'html, body', disabled = false,
        headingsPos, scrolling = false, hasRendered = false, hasInit = false;

      function setOptions(options) {
        var _options = options || {};
        _options.selectors && (selectors = _options.selectors);
        _options.container && (container = _options.container);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroller && (scroller = _options.scroller);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $headings = $(container).find(selectors).filter('[id]');
        $scrollTarget = $(scrollTarget);
        $scroller = $(scroller);
      }
      function calc() {
        headingsPos = [];
        $headings.each(function() {
          headingsPos.push(Math.floor($(this).position().top));
        });
      }
      function setState(element, disabled) {
        var scrollTop = $scrollTarget.scrollTop(), i;
        if (disabled || !headingsPos || headingsPos.length < 1) { return; }
        if (element) {
          $activeCur = element;
        } else {
          for (i = 0; i < headingsPos.length; i++) {
            if (scrollTop >= headingsPos[i]) {
              $activeCur = $tocLi.eq(i);
            } else {
              $activeCur || ($activeCur = $tocLi.eq(i));
              break;
            }
          }
        }
        $activeLast && $activeLast.removeClass('active');
        ($activeLast = $activeCur).addClass('active');
      }
      function render() {
        if(!hasRendered) {
          $root.append($tocUl);
          $headings.each(function() {
            var $this = $(this);
            $tocUl.append($('<li></li>').addClass('toc-' + $this.prop('tagName').toLowerCase())
              .append($('<a></a>').text($this.text()).attr('href', '#' + $this.prop('id'))));
          });
          $tocLi = $tocUl.children('li');
          $tocUl.on('click', 'a', function(e) {
            e.preventDefault();
            var $this = $(this);
            scrolling = true;
            setState($this.parent());
            $scroller.scrollToAnchor($this.attr('href'), 400, function() {
              scrolling = false;
            });
          });
        }
        hasRendered = true;
      }
      function init() {
        var interval, timeout;
        if(!hasInit) {
          render(); calc(); setState(null, scrolling);
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState(null, scrolling);
          });
          $window.on('resize', window.throttle(function() {
            if (!disabled) {
              render(); calc(); setState(null, scrolling);
            }
          }, 100));
        }
        hasInit = true;
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions
      };
    }
    $.fn.toc = toc;
  });
})();
/*(function () {

})();*/
</script><script>
  /* toc must before affix, since affix need to konw toc' height. */(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  var TOC_SELECTOR = window.TEXT_VARIABLES.site.toc.selectors;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window);
    var $articleContent = $('.js-article-content');
    var $tocRoot = $('.js-toc-root'), $col2 = $('.js-col-aside');
    var toc;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
    var hasToc = $articleContent.find(TOC_SELECTOR).length > 0;

    function disabled() {
      return $col2.css('display') === 'none' || !hasToc;
    }

    tocDisabled = disabled();

    toc = $tocRoot.toc({
      selectors: TOC_SELECTOR,
      container: $articleContent,
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      tocDisabled = disabled();
      toc && toc.setOptions({
        disabled: tocDisabled
      });
    }, 100));

  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window), $pageFooter = $('.js-page-footer');
    var $pageAside = $('.js-page-aside');
    var affix;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');

    affix = $pageAside.affix({
      offsetBottom: $pageFooter.outerHeight(),
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      scroll: hasSidebar ? $('.js-page-main').children() : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      affix && affix.setOptions({
        disabled: tocDisabled
      });
    }, 100));

    window.pageAsideAffix = affix;
  });
})();
</script>
    </div>
    <script>(function () {
  var $root = document.getElementsByClassName('root')[0];
  if (window.hasEvent('touchstart')) {
    $root.dataset.isTouch = true;
    document.addEventListener('touchstart', function(){}, false);
  }
})();
</script>
  </body>
</html>


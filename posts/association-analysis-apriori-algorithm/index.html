<!DOCTYPE html><html lang="en">
  <head><!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-85831520-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-85831520-1');
		
	</script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"><title>Association analysis - Apriori algorithm - Jingwen Zheng</title>

<meta name="description" content="Have your heard about the classic use case of association analysis -“Beer and diaper” at Walmart? In this story, Walmart foundthat beer and diapers were ofte...">

<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Association analysis - Apriori algorithm | Jingwen Zheng</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Association analysis - Apriori algorithm" />
<meta name="author" content="Jingwen Zheng" />
<meta property="og:locale" content="en" />
<meta name="description" content="Have your heard about the classic use case of association analysis - “Beer and diaper” at Walmart? In this story, Walmart found that beer and diapers were often sold together, we can use association analysis to explain this image. In this blog, I will introduce some useful concepts and then a use case of association analysis. Useful Concepts (resource: Wikipedia) Association analysis is a rule-based machine learning method for discovering interesting relations between variables in large databases. It is intended to identify strong rules discovered in databases using some measures of interestingness. Let X be an itemset, X =&gt; Y an association rule and T a set of transactions of a given database. Support Support is an indication of how frequently the itemset appears in the dataset. The support of X with respect to T is defined as the proportion of transactions t in the dataset which contains the itemset X. Confidence Confidence is an indication of how often the rule has been found to be true. The confidence value of a rule, X =&gt; Y, with respect to a set of transactions T, is the proportion of the transactions that contains X which also contains Y. Confidence is defined as: Note that means the support of the union of the items in X and Y. This is somewhat confusing since we normally think in terms of probabilities of events and not sets of items. We can rewrite as the probability , where and are the events that a transaction contains itemset X and Y, respectively. Thus confidence can be interpreted as an estimate of the conditional probability , the probability of finding the RHS of the rule in transactions under the condition that these transactions also contain the LHS. Lift The lift of a rule is defined as: or the ratio of the observed support to that expected if X and Y were independent. If the rule had a lift of 1, it would imply that the probability of occurrence of the antecedent and that of the consequent are independent of each other. When two events are independent of each other, no rule can be drawn involving those two events. If the lift is &gt; 1, that lets us know the degree to which those two occurrences are dependent on one another, and makes those rules potentially useful for predicting the consequent in future data sets. The value of lift is that it considers both the confidence of the rule and the overall data set. Use case Dataset I will use the Groceries dataset which comes from package arules. library(arules) data(Groceries) class(Groceries) [1] &quot;transactions&quot; attr(,&quot;package&quot;) [1] &quot;arules&quot; inspect(head(Groceries, 3)) items [1] {citrus fruit,semi-finished bread,margarine,ready soups} [2] {tropical fruit,yogurt,coffee} [3] {whole milk} summary(Groceries) transactions as itemMatrix in sparse format with 9835 rows (elements/itemsets/transactions) and 169 columns (items) and a density of 0.02609146 most frequent items: whole milk other vegetables rolls/buns soda yogurt (Other) 2513 1903 1809 1715 1372 34055 element (itemset/transaction) length distribution: sizes 1 2 3 4 5 6 7 8 9 10 11 12 13 2159 1643 1299 1005 855 645 545 438 350 246 182 117 78 14 15 16 17 18 19 20 21 22 23 24 26 27 77 55 46 29 14 14 9 11 4 6 1 1 1 28 29 32 1 3 1 Min. 1st Qu. Median Mean 3rd Qu. Max. 1.000 2.000 3.000 4.409 6.000 32.000 includes extended item information - examples: labels level2 level1 1 frankfurter sausage meat and sausage 2 sausage sausage meat and sausage 3 liver loaf sausage meat and sausage Before creating the model, we have a view of data. In this dataset, there are 9835 transactions and 169 items, the density of 1 in sparse matrix is 0.02609146. The 5 most frequent items are whole milk, other vegetables, rolls/buns, soda and yogurt. Element length distribution shows items’ amount in the transaction and transactions’ amount. For instance, 2159 transactions have only 1 item, 545 transactions have 7 items, and only 1 transaction has 27 items. Model The value of support is useful for creating the model. We can use the function itemFrequencyPlot() to check top N frequent item. itemFrequencyPlot(Groceries, topN=10, type=&quot;absolute&quot;, main=&quot;Item Frequency&quot;) Now we have a clear idea about the data, next we can create the model. rules &lt;- apriori (Groceries, parameter = list(supp = 0.001, conf = 0.5)) rulesLift &lt;- sort (rules, by = &quot;lift&quot;, decreasing = T) inspect(head(rulesLift)) lhs rhs support confidence lift count [1] {Instant food products,soda} =&gt; {hamburger meat} 0.001220132 0.6315789 18.99565 12 [2] {soda,popcorn} =&gt; {salty snack} 0.001220132 0.6315789 16.69779 12 [3] {flour,baking powder} =&gt; {sugar} 0.001016777 0.5555556 16.40807 10 [4] {ham,processed cheese} =&gt; {white bread} 0.001931876 0.6333333 15.04549 19 [5] {whole milk,Instant food products} =&gt; {hamburger meat} 0.001525165 0.5000000 15.03823 15 [6] {other vegetables,curd,yogurt,whipped/sour cream} =&gt; {cream cheese } 0.001016777 0.5882353 14.83409 10 inspect() function shows us each rule in detail, its support value, confidence value and lift value. Visualisation Scatter plot library(arulesViz) plot(rules, control = list(jitter = 2), shading = &quot;lift&quot;) According this scatter plot, we find that support values of association analysis in general are lower, confidence values are well-distributed, and lift values of most rules are greater than 3. So these rule are significant. Grouped matrix plot Grouped matrix plot cluster similar rules, then shows the general distribution of clustered rules. Be default, number of cluster is 20, here I set to 15. plot(rules, method = &quot;grouped&quot;, control = list(k = 15)) Similar association rules are grouped into one cluster, which can extract the overall regularities and similarities of association rules. Horizontal ordinate stands for 15 clusters, vertical ordinate stands for the items generated by 15 rules. The depth of color presents the degree of lift, the deeper color is, the larger lift is. The size of circle presents the degree of support, the bigger circle is, the larger support is. Graph plot library(igraph) library(visNetwork) subrules &lt;- head(sort(rules, by = &quot;lift&quot;), 10) plot(subrules, method = &quot;graph&quot;) Since there are enormous rules, here I just take 10 rules whose lifts are 10 largest, to make graph plot. In this graph, resource means antecedent (LHS), arrow means relation direction, the circle between them means the confidence of this rule. The bigger circle is, the larger confidence is. The depth of color means the lift, the deeper color is, the larger lift is. The end of arrow pointing means the consequent (RHS) of this rule. Following codes create a dynamic graph which is similar as above. graphDF &lt;- get.data.frame(plot(subrules, method = &quot;graph&quot;), what = &quot;both&quot;) visNetwork( nodes &lt;- data.frame(id = graphDF$vertices$name, value = graphDF$vertices$support, title = ifelse(graphDF$vertices$label == &quot;&quot;, graphDF$vertices$name, graphDF$vertices$label), graphDF$vertices), edges &lt;- graphDF$edges ) %&gt;% visOptions(highlightNearest = TRUE) Dynamic graph How to understand this graph? Let’s take “yogurt” as an example. Click circle “yogurt”, then the circle is linked with other 4 circles, 3 small and 1 big, each of them stands for a basket. We can take the biggest one, click it, then we find that in this basket, there are also butter, whole milk, domistic eggs, tropical fruits and other vegetables. So we can say that all these products are associated with yogurt. Association analysis is a useful way to analyse the relation between 2 different products, which can also help the decision of retailing. Reference Junjie Xu, “assorted bottles and cans in commercial coolers”, www.pexels.com. [Online]. Available: https://www.pexels.com/photo/assorted-bottles-and-cans-in-commercial-coolers-3028500/" />
<meta property="og:description" content="Have your heard about the classic use case of association analysis - “Beer and diaper” at Walmart? In this story, Walmart found that beer and diapers were often sold together, we can use association analysis to explain this image. In this blog, I will introduce some useful concepts and then a use case of association analysis. Useful Concepts (resource: Wikipedia) Association analysis is a rule-based machine learning method for discovering interesting relations between variables in large databases. It is intended to identify strong rules discovered in databases using some measures of interestingness. Let X be an itemset, X =&gt; Y an association rule and T a set of transactions of a given database. Support Support is an indication of how frequently the itemset appears in the dataset. The support of X with respect to T is defined as the proportion of transactions t in the dataset which contains the itemset X. Confidence Confidence is an indication of how often the rule has been found to be true. The confidence value of a rule, X =&gt; Y, with respect to a set of transactions T, is the proportion of the transactions that contains X which also contains Y. Confidence is defined as: Note that means the support of the union of the items in X and Y. This is somewhat confusing since we normally think in terms of probabilities of events and not sets of items. We can rewrite as the probability , where and are the events that a transaction contains itemset X and Y, respectively. Thus confidence can be interpreted as an estimate of the conditional probability , the probability of finding the RHS of the rule in transactions under the condition that these transactions also contain the LHS. Lift The lift of a rule is defined as: or the ratio of the observed support to that expected if X and Y were independent. If the rule had a lift of 1, it would imply that the probability of occurrence of the antecedent and that of the consequent are independent of each other. When two events are independent of each other, no rule can be drawn involving those two events. If the lift is &gt; 1, that lets us know the degree to which those two occurrences are dependent on one another, and makes those rules potentially useful for predicting the consequent in future data sets. The value of lift is that it considers both the confidence of the rule and the overall data set. Use case Dataset I will use the Groceries dataset which comes from package arules. library(arules) data(Groceries) class(Groceries) [1] &quot;transactions&quot; attr(,&quot;package&quot;) [1] &quot;arules&quot; inspect(head(Groceries, 3)) items [1] {citrus fruit,semi-finished bread,margarine,ready soups} [2] {tropical fruit,yogurt,coffee} [3] {whole milk} summary(Groceries) transactions as itemMatrix in sparse format with 9835 rows (elements/itemsets/transactions) and 169 columns (items) and a density of 0.02609146 most frequent items: whole milk other vegetables rolls/buns soda yogurt (Other) 2513 1903 1809 1715 1372 34055 element (itemset/transaction) length distribution: sizes 1 2 3 4 5 6 7 8 9 10 11 12 13 2159 1643 1299 1005 855 645 545 438 350 246 182 117 78 14 15 16 17 18 19 20 21 22 23 24 26 27 77 55 46 29 14 14 9 11 4 6 1 1 1 28 29 32 1 3 1 Min. 1st Qu. Median Mean 3rd Qu. Max. 1.000 2.000 3.000 4.409 6.000 32.000 includes extended item information - examples: labels level2 level1 1 frankfurter sausage meat and sausage 2 sausage sausage meat and sausage 3 liver loaf sausage meat and sausage Before creating the model, we have a view of data. In this dataset, there are 9835 transactions and 169 items, the density of 1 in sparse matrix is 0.02609146. The 5 most frequent items are whole milk, other vegetables, rolls/buns, soda and yogurt. Element length distribution shows items’ amount in the transaction and transactions’ amount. For instance, 2159 transactions have only 1 item, 545 transactions have 7 items, and only 1 transaction has 27 items. Model The value of support is useful for creating the model. We can use the function itemFrequencyPlot() to check top N frequent item. itemFrequencyPlot(Groceries, topN=10, type=&quot;absolute&quot;, main=&quot;Item Frequency&quot;) Now we have a clear idea about the data, next we can create the model. rules &lt;- apriori (Groceries, parameter = list(supp = 0.001, conf = 0.5)) rulesLift &lt;- sort (rules, by = &quot;lift&quot;, decreasing = T) inspect(head(rulesLift)) lhs rhs support confidence lift count [1] {Instant food products,soda} =&gt; {hamburger meat} 0.001220132 0.6315789 18.99565 12 [2] {soda,popcorn} =&gt; {salty snack} 0.001220132 0.6315789 16.69779 12 [3] {flour,baking powder} =&gt; {sugar} 0.001016777 0.5555556 16.40807 10 [4] {ham,processed cheese} =&gt; {white bread} 0.001931876 0.6333333 15.04549 19 [5] {whole milk,Instant food products} =&gt; {hamburger meat} 0.001525165 0.5000000 15.03823 15 [6] {other vegetables,curd,yogurt,whipped/sour cream} =&gt; {cream cheese } 0.001016777 0.5882353 14.83409 10 inspect() function shows us each rule in detail, its support value, confidence value and lift value. Visualisation Scatter plot library(arulesViz) plot(rules, control = list(jitter = 2), shading = &quot;lift&quot;) According this scatter plot, we find that support values of association analysis in general are lower, confidence values are well-distributed, and lift values of most rules are greater than 3. So these rule are significant. Grouped matrix plot Grouped matrix plot cluster similar rules, then shows the general distribution of clustered rules. Be default, number of cluster is 20, here I set to 15. plot(rules, method = &quot;grouped&quot;, control = list(k = 15)) Similar association rules are grouped into one cluster, which can extract the overall regularities and similarities of association rules. Horizontal ordinate stands for 15 clusters, vertical ordinate stands for the items generated by 15 rules. The depth of color presents the degree of lift, the deeper color is, the larger lift is. The size of circle presents the degree of support, the bigger circle is, the larger support is. Graph plot library(igraph) library(visNetwork) subrules &lt;- head(sort(rules, by = &quot;lift&quot;), 10) plot(subrules, method = &quot;graph&quot;) Since there are enormous rules, here I just take 10 rules whose lifts are 10 largest, to make graph plot. In this graph, resource means antecedent (LHS), arrow means relation direction, the circle between them means the confidence of this rule. The bigger circle is, the larger confidence is. The depth of color means the lift, the deeper color is, the larger lift is. The end of arrow pointing means the consequent (RHS) of this rule. Following codes create a dynamic graph which is similar as above. graphDF &lt;- get.data.frame(plot(subrules, method = &quot;graph&quot;), what = &quot;both&quot;) visNetwork( nodes &lt;- data.frame(id = graphDF$vertices$name, value = graphDF$vertices$support, title = ifelse(graphDF$vertices$label == &quot;&quot;, graphDF$vertices$name, graphDF$vertices$label), graphDF$vertices), edges &lt;- graphDF$edges ) %&gt;% visOptions(highlightNearest = TRUE) Dynamic graph How to understand this graph? Let’s take “yogurt” as an example. Click circle “yogurt”, then the circle is linked with other 4 circles, 3 small and 1 big, each of them stands for a basket. We can take the biggest one, click it, then we find that in this basket, there are also butter, whole milk, domistic eggs, tropical fruits and other vegetables. So we can say that all these products are associated with yogurt. Association analysis is a useful way to analyse the relation between 2 different products, which can also help the decision of retailing. Reference Junjie Xu, “assorted bottles and cans in commercial coolers”, www.pexels.com. [Online]. Available: https://www.pexels.com/photo/assorted-bottles-and-cans-in-commercial-coolers-3028500/" />
<link rel="canonical" href="https://jingwen-z.github.io//posts/association-analysis-apriori-algorithm/" />
<meta property="og:url" content="https://jingwen-z.github.io//posts/association-analysis-apriori-algorithm/" />
<meta property="og:site_name" content="Jingwen Zheng" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-10-20T23:16:08+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Association analysis - Apriori algorithm" />
<meta name="twitter:site" content="@Jingwen_QI" />
<meta name="twitter:creator" content="@Jingwen Zheng" />
<script type="application/ld+json">
{"headline":"Association analysis - Apriori algorithm","dateModified":"2017-10-20T23:16:08+02:00","datePublished":"2017-10-20T23:16:08+02:00","description":"Have your heard about the classic use case of association analysis - “Beer and diaper” at Walmart? In this story, Walmart found that beer and diapers were often sold together, we can use association analysis to explain this image. In this blog, I will introduce some useful concepts and then a use case of association analysis. Useful Concepts (resource: Wikipedia) Association analysis is a rule-based machine learning method for discovering interesting relations between variables in large databases. It is intended to identify strong rules discovered in databases using some measures of interestingness. Let X be an itemset, X =&gt; Y an association rule and T a set of transactions of a given database. Support Support is an indication of how frequently the itemset appears in the dataset. The support of X with respect to T is defined as the proportion of transactions t in the dataset which contains the itemset X. Confidence Confidence is an indication of how often the rule has been found to be true. The confidence value of a rule, X =&gt; Y, with respect to a set of transactions T, is the proportion of the transactions that contains X which also contains Y. Confidence is defined as: Note that means the support of the union of the items in X and Y. This is somewhat confusing since we normally think in terms of probabilities of events and not sets of items. We can rewrite as the probability , where and are the events that a transaction contains itemset X and Y, respectively. Thus confidence can be interpreted as an estimate of the conditional probability , the probability of finding the RHS of the rule in transactions under the condition that these transactions also contain the LHS. Lift The lift of a rule is defined as: or the ratio of the observed support to that expected if X and Y were independent. If the rule had a lift of 1, it would imply that the probability of occurrence of the antecedent and that of the consequent are independent of each other. When two events are independent of each other, no rule can be drawn involving those two events. If the lift is &gt; 1, that lets us know the degree to which those two occurrences are dependent on one another, and makes those rules potentially useful for predicting the consequent in future data sets. The value of lift is that it considers both the confidence of the rule and the overall data set. Use case Dataset I will use the Groceries dataset which comes from package arules. library(arules) data(Groceries) class(Groceries) [1] &quot;transactions&quot; attr(,&quot;package&quot;) [1] &quot;arules&quot; inspect(head(Groceries, 3)) items [1] {citrus fruit,semi-finished bread,margarine,ready soups} [2] {tropical fruit,yogurt,coffee} [3] {whole milk} summary(Groceries) transactions as itemMatrix in sparse format with 9835 rows (elements/itemsets/transactions) and 169 columns (items) and a density of 0.02609146 most frequent items: whole milk other vegetables rolls/buns soda yogurt (Other) 2513 1903 1809 1715 1372 34055 element (itemset/transaction) length distribution: sizes 1 2 3 4 5 6 7 8 9 10 11 12 13 2159 1643 1299 1005 855 645 545 438 350 246 182 117 78 14 15 16 17 18 19 20 21 22 23 24 26 27 77 55 46 29 14 14 9 11 4 6 1 1 1 28 29 32 1 3 1 Min. 1st Qu. Median Mean 3rd Qu. Max. 1.000 2.000 3.000 4.409 6.000 32.000 includes extended item information - examples: labels level2 level1 1 frankfurter sausage meat and sausage 2 sausage sausage meat and sausage 3 liver loaf sausage meat and sausage Before creating the model, we have a view of data. In this dataset, there are 9835 transactions and 169 items, the density of 1 in sparse matrix is 0.02609146. The 5 most frequent items are whole milk, other vegetables, rolls/buns, soda and yogurt. Element length distribution shows items’ amount in the transaction and transactions’ amount. For instance, 2159 transactions have only 1 item, 545 transactions have 7 items, and only 1 transaction has 27 items. Model The value of support is useful for creating the model. We can use the function itemFrequencyPlot() to check top N frequent item. itemFrequencyPlot(Groceries, topN=10, type=&quot;absolute&quot;, main=&quot;Item Frequency&quot;) Now we have a clear idea about the data, next we can create the model. rules &lt;- apriori (Groceries, parameter = list(supp = 0.001, conf = 0.5)) rulesLift &lt;- sort (rules, by = &quot;lift&quot;, decreasing = T) inspect(head(rulesLift)) lhs rhs support confidence lift count [1] {Instant food products,soda} =&gt; {hamburger meat} 0.001220132 0.6315789 18.99565 12 [2] {soda,popcorn} =&gt; {salty snack} 0.001220132 0.6315789 16.69779 12 [3] {flour,baking powder} =&gt; {sugar} 0.001016777 0.5555556 16.40807 10 [4] {ham,processed cheese} =&gt; {white bread} 0.001931876 0.6333333 15.04549 19 [5] {whole milk,Instant food products} =&gt; {hamburger meat} 0.001525165 0.5000000 15.03823 15 [6] {other vegetables,curd,yogurt,whipped/sour cream} =&gt; {cream cheese } 0.001016777 0.5882353 14.83409 10 inspect() function shows us each rule in detail, its support value, confidence value and lift value. Visualisation Scatter plot library(arulesViz) plot(rules, control = list(jitter = 2), shading = &quot;lift&quot;) According this scatter plot, we find that support values of association analysis in general are lower, confidence values are well-distributed, and lift values of most rules are greater than 3. So these rule are significant. Grouped matrix plot Grouped matrix plot cluster similar rules, then shows the general distribution of clustered rules. Be default, number of cluster is 20, here I set to 15. plot(rules, method = &quot;grouped&quot;, control = list(k = 15)) Similar association rules are grouped into one cluster, which can extract the overall regularities and similarities of association rules. Horizontal ordinate stands for 15 clusters, vertical ordinate stands for the items generated by 15 rules. The depth of color presents the degree of lift, the deeper color is, the larger lift is. The size of circle presents the degree of support, the bigger circle is, the larger support is. Graph plot library(igraph) library(visNetwork) subrules &lt;- head(sort(rules, by = &quot;lift&quot;), 10) plot(subrules, method = &quot;graph&quot;) Since there are enormous rules, here I just take 10 rules whose lifts are 10 largest, to make graph plot. In this graph, resource means antecedent (LHS), arrow means relation direction, the circle between them means the confidence of this rule. The bigger circle is, the larger confidence is. The depth of color means the lift, the deeper color is, the larger lift is. The end of arrow pointing means the consequent (RHS) of this rule. Following codes create a dynamic graph which is similar as above. graphDF &lt;- get.data.frame(plot(subrules, method = &quot;graph&quot;), what = &quot;both&quot;) visNetwork( nodes &lt;- data.frame(id = graphDF$vertices$name, value = graphDF$vertices$support, title = ifelse(graphDF$vertices$label == &quot;&quot;, graphDF$vertices$name, graphDF$vertices$label), graphDF$vertices), edges &lt;- graphDF$edges ) %&gt;% visOptions(highlightNearest = TRUE) Dynamic graph How to understand this graph? Let’s take “yogurt” as an example. Click circle “yogurt”, then the circle is linked with other 4 circles, 3 small and 1 big, each of them stands for a basket. We can take the biggest one, click it, then we find that in this basket, there are also butter, whole milk, domistic eggs, tropical fruits and other vegetables. So we can say that all these products are associated with yogurt. Association analysis is a useful way to analyse the relation between 2 different products, which can also help the decision of retailing. Reference Junjie Xu, “assorted bottles and cans in commercial coolers”, www.pexels.com. [Online]. Available: https://www.pexels.com/photo/assorted-bottles-and-cans-in-commercial-coolers-3028500/","author":{"@type":"Person","name":"Jingwen Zheng"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://jingwen-z.github.io//posts/association-analysis-apriori-algorithm/"},"@type":"BlogPosting","url":"https://jingwen-z.github.io//posts/association-analysis-apriori-algorithm/","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


<!-- Extra Open Graph :: Start -->

<!-- Extra Open Graph :: End -->

<link rel="canonical" href="https://jingwen-z.github.io//posts/association-analysis-apriori-algorithm/"><link rel="alternate" type="application/rss+xml" title="Jingwen Zheng" href="/feed.xml"><!-- start favicons snippet, use https://realfavicongenerator.net/ --><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="manifest" href="/assets/site.webmanifest"><link rel="mask-icon" href="/assets/safari-pinned-tab.svg" color="#fc4d50"><link rel="shortcut icon" href="/assets/favicon.ico">

<meta name="msapplication-TileColor" content="#ffc40d"><meta name="msapplication-config" content="/assets/browserconfig.xml">

<meta name="theme-color" content="#ffffff">
<!-- end favicons snippet --><link rel="stylesheet" href="/assets/css/main.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.1/css/all.css" ><!-- start custom head snippets -->

<!-- end custom head snippets -->
<script>(function() {
  window.isArray = function(val) {
    return Object.prototype.toString.call(val) === '[object Array]';
  };
  window.isString = function(val) {
    return typeof val === 'string';
  };

  window.hasEvent = function(event) {
    return 'on'.concat(event) in window.document;
  };

  window.isOverallScroller = function(node) {
    return node === document.documentElement || node === document.body || node === window;
  };

  window.isFormElement = function(node) {
    var tagName = node.tagName;
    return tagName === 'INPUT' || tagName === 'SELECT' || tagName === 'TEXTAREA';
  };

  window.pageLoad = (function () {
    var loaded = false, cbs = [];
    window.addEventListener('load', function () {
      var i;
      loaded = true;
      if (cbs.length > 0) {
        for (i = 0; i < cbs.length; i++) {
          cbs[i]();
        }
      }
    });
    return {
      then: function(cb) {
        cb && (loaded ? cb() : (cbs.push(cb)));
      }
    };
  })();
})();
(function() {
  window.throttle = function(func, wait) {
    var args, result, thisArg, timeoutId, lastCalled = 0;

    function trailingCall() {
      lastCalled = new Date;
      timeoutId = null;
      result = func.apply(thisArg, args);
    }
    return function() {
      var now = new Date,
        remaining = wait - (now - lastCalled);

      args = arguments;
      thisArg = this;

      if (remaining <= 0) {
        clearTimeout(timeoutId);
        timeoutId = null;
        lastCalled = now;
        result = func.apply(thisArg, args);
      } else if (!timeoutId) {
        timeoutId = setTimeout(trailingCall, remaining);
      }
      return result;
    };
  };
})();
(function() {
  var Set = (function() {
    var add = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (data[i] === item) {
          return;
        }
      }
      this.size ++;
      data.push(item);
      return data;
    };

    var Set = function(data) {
      this.size = 0;
      this._data = [];
      var i;
      if (data.length > 0) {
        for (i = 0; i < data.length; i++) {
          add.call(this, data[i]);
        }
      }
    };
    Set.prototype.add = add;
    Set.prototype.get = function(index) { return this._data[index]; };
    Set.prototype.has = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (this.get(i) === item) {
          return true;
        }
      }
      return false;
    };
    Set.prototype.is = function(map) {
      if (map._data.length !== this._data.length) { return false; }
      var i, j, flag, tData = this._data, mData = map._data;
      for (i = 0; i < tData.length; i++) {
        for (flag = false, j = 0; j < mData.length; j++) {
          if (tData[i] === mData[j]) {
            flag = true;
            break;
          }
        }
        if (!flag) { return false; }
      }
      return true;
    };
    Set.prototype.values = function() {
      return this._data;
    };
    return Set;
  })();

  window.Lazyload = (function(doc) {
    var queue = {js: [], css: []}, sources = {js: {}, css: {}}, context = this;
    var createNode = function(name, attrs) {
      var node = doc.createElement(name), attr;
      for (attr in attrs) {
        if (attrs.hasOwnProperty(attr)) {
          node.setAttribute(attr, attrs[attr]);
        }
      }
      return node;
    };
    var end = function(type, url) {
      var s, q, qi, cbs, i, j, cur, val, flag;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        s[url] = true;
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (cur.urls.has(url)) {
            qi = cur, val = qi.urls.values();
            qi && (cbs = qi.callbacks);
            for (flag = true, j = 0; j < val.length; j++) {
              cur = val[j];
              if (!s[cur]) {
                flag = false;
              }
            }
            if (flag && cbs && cbs.length > 0) {
              for (j = 0; j < cbs.length; j++) {
                cbs[j].call(context);
              }
              qi.load = true;
            }
          }
        }
      }
    };
    var load = function(type, urls, callback) {
      var s, q, qi, node, i, cur,
        _urls = typeof urls === 'string' ? new Set([urls]) : new Set(urls), val, url;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (_urls.is(cur.urls)) {
            qi = cur;
            break;
          }
        }
        val = _urls.values();
        if (qi) {
          callback && (qi.load || qi.callbacks.push(callback));
          callback && (qi.load && callback());
        } else {
          q.push({
            urls: _urls,
            callbacks: callback ? [callback] : [],
            load: false
          });
          for (i = 0; i < val.length; i++) {
            node = null, url = val[i];
            if (s[url] === undefined) {
              (type === 'js' ) && (node = createNode('script', { src: url }));
              (type === 'css') && (node = createNode('link', { rel: 'stylesheet', href: url }));
              if (node) {
                node.onload = (function(type, url) {
                  return function() {
                    end(type, url);
                  };
                })(type, url);
                (doc.head || doc.body).appendChild(node);
                s[url] = false;
              }
            }
          }
        }
      }
    };
    return {
      js: function(url, callback) {
        load('js', url, callback);
      },
      css: function(url, callback) {
        load('css', url, callback);
      }
    };
  })(this.document);
})();
</script><script>
  (function() {
    var TEXT_VARIABLES = {
      version: '2.2.6',
      sources: {
        font_awesome: 'https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.1/css/all.css',
        jquery: 'https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js',
        leancloud_js_sdk: '//cdn.jsdelivr.net/npm/leancloud-storage@3.13.2/dist/av-min.js',
        chart: 'https://cdn.bootcss.com/Chart.js/2.7.2/Chart.bundle.min.js',
        gitalk: {
          js: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.js',
          css: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.css'
        },
        valine: 'https://unpkg.com/valine/dist/Valine.min.js',
        mathjax: 'https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML',
        mermaid: 'https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js'
      },
      site: {
        toc: {
          selectors: 'h1,h2,h3'
        }
      },
      paths: {
        search_js: '/assets/search.js'
      }
    };
    window.TEXT_VARIABLES = TEXT_VARIABLES;
  })();
</script>
</head>
  <body>
    <div class="root" data-is-touch="false">
      <div class="layout--page js-page-root"><div class="page__main js-page-main page__viewport has-aside cell cell--auto">

      <div class="page__main-inner"><div class="page__header d-print-none"><header class="header"><div class="main">
      <div class="header__title">
        <div class="header__brand"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="24px" height="24px" viewBox="0 0 24 24">
<style type="text/css">
	.st0{fill:#515151;}
</style>
<path class="st0" d="M1.7,22.3c5.7-5.7,11.3-5.7,17,0c3.3-3.3,3.5-5.3,0.8-6c2.7,0.7,3.5-1.1,2.3-5.6s-3.3-5.2-6.3-2.1
	c3-3,2.3-5.2-2.1-6.3S7,1.8,7.7,4.6C7,1.8,5,2.1,1.7,5.3C7.3,11,7.3,16.7,1.7,22.3"/>
</svg>

          <a title="Data Science Enthusiast
" href="/">Jingwen Zheng</a>
        </div><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></div><nav class="navigation">
        <ul><li class="navigation__item"><a href="/portfolio">Portfolio</a></li><li class="navigation__item"><a href="/archive">Archive</a></li><li class="navigation__item"><a href="/about">About</a></li><li><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></li></ul>
      </nav></div>
  </header>
</div><div class="page__content"><div class="article__header--overlay"><div class="hero hero--dark overlay" style="background-image:linear-gradient(135deg, rgba(0, 0, 0, .6), rgba(0, 0, 0, .4)),url(/images/20171020-pexels-junjie-xu.jpg);background-color:#203028;"><div class="hero__content"><div class ="main"><div class="article__info clearfix"><ul class="left-col menu"><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive?tag=Machine-Learning">Machine-Learning</a>
            </li><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive?tag=Association-analysis">Association-analysis</a>
            </li></ul><ul class="right-col menu"><li><i class="far fa-calendar-alt"></i> <span>Oct 20, 2017</span>
            </li></ul></div><div class="article__header"><header><h1>Association analysis - Apriori algorithm</h1></header></div><p class="overlay__excerpt">Have your heard about the classic use case of association analysis -“Beer and diaper” at Walmart? In this story, Walmart foundthat beer and diapers were often sold together, we can use association ...</p></div></div>
              </div>
            </div><div class ="main"><div class="grid grid--reverse">

              <div class="col-aside d-print-none js-col-aside"><aside class="page__aside js-page-aside"><div class="toc-aside js-toc-root"></div>
</aside></div>

              <div class="col-main cell cell--auto"><!-- start custom main top snippet -->

<!-- end custom main top snippet -->
<article itemscope itemtype="http://schema.org/Article"><meta itemprop="headline" content="Association analysis - Apriori algorithm"><meta itemprop="author" content="Jingwen Zheng"/><meta itemprop="datePublished" content="2017-10-20T23:16:08+02:00">
    <meta itemprop="keywords" content="Machine-Learning,Association-analysis"><div class="js-article-content"><div class="layout--article"><!-- start custom article top snippet -->

<!-- end custom article top snippet -->
<div class="article__content" itemprop="articleBody"><p>Have your heard about the classic use case of association analysis -
“<a href="https://blog.bissantz.com/myth-of-data-mining">Beer and diaper</a>” at Walmart? In this story, Walmart found
that beer and diapers were often sold together, we can use association analysis
to explain this image.</p>

<p>In this blog, I will introduce some useful concepts and then a use case of
association analysis.</p>

<h2 id="useful-concepts-resource-wikipedia">Useful Concepts (resource: <a href="https://en.wikipedia.org/wiki/Association_rule_learning">Wikipedia</a>)</h2>

<p><strong>Association analysis</strong> is a rule-based machine learning method for discovering
interesting relations between variables in large databases. It is intended to
identify strong rules discovered in databases using some measures of
interestingness.</p>

<p>Let <strong><em>X</em></strong> be an itemset, <strong><em>X</em> =&gt; <em>Y</em></strong> an association rule and <strong><em>T</em></strong> a set
of transactions of a given database.</p>

<h3 id="support">Support</h3>

<p>Support is an indication of how frequently the itemset appears in the dataset.
The support of <strong><em>X</em></strong> with respect to <strong><em>T</em></strong> is defined as the proportion of
transactions <strong><em>t</em></strong> in the dataset which contains the itemset <strong><em>X</em></strong>.</p>

<p align="center">
<img alt="support" src="https://latex.codecogs.com/gif.latex?\fn_jvn&space;supp(X)&space;=&space;\frac{\left&space;|&space;{t\in&space;T;&space;X\subseteq&space;t}&space;\right&space;|}{\left&space;|&space;T&space;\right&space;|}" />
</p>

<h3 id="confidence">Confidence</h3>

<p>Confidence is an indication of how often the rule has been found to be true.</p>

<p>The confidence value of a rule, <strong><em>X</em> =&gt; <em>Y</em></strong>, with respect to a set of
transactions <strong><em>T</em></strong>, is the proportion of the transactions that contains <strong><em>X</em></strong>
which also contains <strong><em>Y</em></strong>.</p>

<p>Confidence is defined as:</p>

<p align="center">
<img alt="confidence" src="https://latex.codecogs.com/gif.latex?\fn_jvn&space;conf(X\Rightarrow&space;Y)&space;=&space;\frac{supp(X\cup&space;Y)}{supp(X)}" />
</p>

<p>Note that
<img alt="supp(X\cup Y)" src="https://latex.codecogs.com/gif.latex?\fn_jvn&space;supp(X\cup&space;Y)" />
means the support of the union of the items in X and Y. This is somewhat
confusing since we normally think in terms of probabilities of events and not
sets of items. We can rewrite
<img alt="supp(X\cup Y)" src="https://latex.codecogs.com/gif.latex?\fn_jvn&space;supp(X\cup&space;Y)" />
as the probability
<img alt="E_X\wedgeE_Y" src="https://latex.codecogs.com/gif.latex?\fn_jvn&space;P(E_{X}\wedge&space;E_{Y})" />,
where
<img alt="E_X" src="https://latex.codecogs.com/gif.latex?\fn_jvn&space;E_{X}" />
and <img alt="E_Y" src="https://latex.codecogs.com/gif.latex?\fn_jvn&space;E_{Y}" />
are the events that a transaction contains itemset <strong><em>X</em></strong> and <strong><em>Y</em></strong>,
respectively.</p>

<p>Thus confidence can be interpreted as an estimate of the conditional probability
<img alt="E_X|E_Y" src="https://latex.codecogs.com/gif.latex?\fn_jvn&space;P(E_{X}&space;|&space;E_{Y})" />,
the probability of finding the RHS of the rule in transactions under the
condition that these transactions also contain the LHS.</p>

<h3 id="lift">Lift</h3>

<p>The lift of a rule is defined as:</p>

<p align="center">
<img alt="lift" src="https://latex.codecogs.com/gif.latex?\fn_jvn&space;lift(X\Rightarrow&space;Y)&space;=&space;\frac{supp(X\cup&space;Y)}{supp(X)*supp(Y)}" />
</p>

<p>or the ratio of the observed support to that expected if X and Y were independent.</p>

<p>If the rule had a lift of 1, it would imply that the probability of occurrence
of the antecedent and that of the consequent are independent of each other. When
two events are independent of each other, no rule can be drawn involving those
two events.</p>

<p>If the lift is &gt; 1, that lets us know the degree to which those two occurrences
are dependent on one another, and makes those rules potentially useful for
predicting the consequent in future data sets.</p>

<p>The value of lift is that it considers both the confidence of the rule and the
overall data set.</p>

<h2 id="use-case">Use case</h2>

<h3 id="dataset">Dataset</h3>

<p>I will use the <code class="language-plaintext highlighter-rouge">Groceries</code> dataset which comes from package <code class="language-plaintext highlighter-rouge">arules</code>.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">arules</span><span class="p">)</span><span class="w">

</span><span class="n">data</span><span class="p">(</span><span class="n">Groceries</span><span class="p">)</span><span class="w">

</span><span class="nf">class</span><span class="p">(</span><span class="n">Groceries</span><span class="p">)</span><span class="w">
</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="s2">"transactions"</span><span class="w">
</span><span class="nf">attr</span><span class="p">(,</span><span class="s2">"package"</span><span class="p">)</span><span class="w">
</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="s2">"arules"</span><span class="w">

</span><span class="n">inspect</span><span class="p">(</span><span class="n">head</span><span class="p">(</span><span class="n">Groceries</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">))</span><span class="w">
    </span><span class="n">items</span><span class="w">                                                   
</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="n">citrus</span><span class="w"> </span><span class="n">fruit</span><span class="p">,</span><span class="n">semi</span><span class="o">-</span><span class="n">finished</span><span class="w"> </span><span class="n">bread</span><span class="p">,</span><span class="n">margarine</span><span class="p">,</span><span class="n">ready</span><span class="w"> </span><span class="n">soups</span><span class="p">}</span><span class="w">
</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="n">tropical</span><span class="w"> </span><span class="n">fruit</span><span class="p">,</span><span class="n">yogurt</span><span class="p">,</span><span class="n">coffee</span><span class="p">}</span><span class="w">                          
</span><span class="p">[</span><span class="m">3</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="n">whole</span><span class="w"> </span><span class="n">milk</span><span class="p">}</span><span class="w"> 

</span><span class="n">summary</span><span class="p">(</span><span class="n">Groceries</span><span class="p">)</span><span class="w">
</span><span class="n">transactions</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">itemMatrix</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">sparse</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="n">with</span><span class="w">
 </span><span class="m">9835</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="p">(</span><span class="n">elements</span><span class="o">/</span><span class="n">itemsets</span><span class="o">/</span><span class="n">transactions</span><span class="p">)</span><span class="w"> </span><span class="n">and</span><span class="w">
 </span><span class="m">169</span><span class="w"> </span><span class="n">columns</span><span class="w"> </span><span class="p">(</span><span class="n">items</span><span class="p">)</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">density</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="m">0.02609146</span><span class="w"> 

</span><span class="n">most</span><span class="w"> </span><span class="n">frequent</span><span class="w"> </span><span class="n">items</span><span class="o">:</span><span class="w">
 </span><span class="n">whole</span><span class="w"> </span><span class="n">milk</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">vegetables</span><span class="w">  </span><span class="n">rolls</span><span class="o">/</span><span class="n">buns</span><span class="w">  </span><span class="n">soda</span><span class="w">  </span><span class="n">yogurt</span><span class="w">  </span><span class="p">(</span><span class="n">Other</span><span class="p">)</span><span class="w">
       </span><span class="m">2513</span><span class="w">             </span><span class="m">1903</span><span class="w">       </span><span class="m">1809</span><span class="w">   </span><span class="m">1715</span><span class="w">    </span><span class="m">1372</span><span class="w">    </span><span class="m">34055</span><span class="w">

</span><span class="n">element</span><span class="w"> </span><span class="p">(</span><span class="n">itemset</span><span class="o">/</span><span class="n">transaction</span><span class="p">)</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="n">distribution</span><span class="o">:</span><span class="w">
</span><span class="n">sizes</span><span class="w">
   </span><span class="m">1</span><span class="w">    </span><span class="m">2</span><span class="w">    </span><span class="m">3</span><span class="w">    </span><span class="m">4</span><span class="w">    </span><span class="m">5</span><span class="w">    </span><span class="m">6</span><span class="w">    </span><span class="m">7</span><span class="w">    </span><span class="m">8</span><span class="w">    </span><span class="m">9</span><span class="w">   </span><span class="m">10</span><span class="w">   </span><span class="m">11</span><span class="w">   </span><span class="m">12</span><span class="w">   </span><span class="m">13</span><span class="w">
</span><span class="m">2159</span><span class="w"> </span><span class="m">1643</span><span class="w"> </span><span class="m">1299</span><span class="w"> </span><span class="m">1005</span><span class="w">  </span><span class="m">855</span><span class="w">  </span><span class="m">645</span><span class="w">  </span><span class="m">545</span><span class="w">  </span><span class="m">438</span><span class="w">  </span><span class="m">350</span><span class="w">  </span><span class="m">246</span><span class="w">  </span><span class="m">182</span><span class="w">  </span><span class="m">117</span><span class="w">   </span><span class="m">78</span><span class="w">
  </span><span class="m">14</span><span class="w">   </span><span class="m">15</span><span class="w">   </span><span class="m">16</span><span class="w">   </span><span class="m">17</span><span class="w">   </span><span class="m">18</span><span class="w">   </span><span class="m">19</span><span class="w">   </span><span class="m">20</span><span class="w">   </span><span class="m">21</span><span class="w">   </span><span class="m">22</span><span class="w">   </span><span class="m">23</span><span class="w">   </span><span class="m">24</span><span class="w">   </span><span class="m">26</span><span class="w">   </span><span class="m">27</span><span class="w">
  </span><span class="m">77</span><span class="w">   </span><span class="m">55</span><span class="w">   </span><span class="m">46</span><span class="w">   </span><span class="m">29</span><span class="w">   </span><span class="m">14</span><span class="w">   </span><span class="m">14</span><span class="w">    </span><span class="m">9</span><span class="w">   </span><span class="m">11</span><span class="w">    </span><span class="m">4</span><span class="w">    </span><span class="m">6</span><span class="w">    </span><span class="m">1</span><span class="w">    </span><span class="m">1</span><span class="w">    </span><span class="m">1</span><span class="w">
  </span><span class="m">28</span><span class="w">   </span><span class="m">29</span><span class="w">   </span><span class="m">32</span><span class="w">
   </span><span class="m">1</span><span class="w">    </span><span class="m">3</span><span class="w">    </span><span class="m">1</span><span class="w">

   </span><span class="n">Min.</span><span class="w"> </span><span class="m">1</span><span class="n">st</span><span class="w"> </span><span class="n">Qu.</span><span class="w">  </span><span class="n">Median</span><span class="w">    </span><span class="n">Mean</span><span class="w"> </span><span class="m">3</span><span class="n">rd</span><span class="w"> </span><span class="n">Qu.</span><span class="w">    </span><span class="n">Max.</span><span class="w"> 
  </span><span class="m">1.000</span><span class="w">   </span><span class="m">2.000</span><span class="w">   </span><span class="m">3.000</span><span class="w">   </span><span class="m">4.409</span><span class="w">   </span><span class="m">6.000</span><span class="w">  </span><span class="m">32.000</span><span class="w"> 

</span><span class="n">includes</span><span class="w"> </span><span class="n">extended</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">examples</span><span class="o">:</span><span class="w">
       </span><span class="n">labels</span><span class="w">  </span><span class="n">level2</span><span class="w">           </span><span class="n">level1</span><span class="w">
</span><span class="m">1</span><span class="w"> </span><span class="n">frankfurter</span><span class="w"> </span><span class="n">sausage</span><span class="w"> </span><span class="n">meat</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">sausage</span><span class="w">
</span><span class="m">2</span><span class="w">     </span><span class="n">sausage</span><span class="w"> </span><span class="n">sausage</span><span class="w"> </span><span class="n">meat</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">sausage</span><span class="w">
</span><span class="m">3</span><span class="w">  </span><span class="n">liver</span><span class="w"> </span><span class="n">loaf</span><span class="w"> </span><span class="n">sausage</span><span class="w"> </span><span class="n">meat</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">sausage</span></code></pre></figure>

<p>Before creating the model, we have a view of data. In this dataset, there are
9835 transactions and 169 items, the density of 1 in sparse matrix is 0.02609146.
The 5 most frequent items are whole milk, other vegetables, rolls/buns, soda and
yogurt. Element length distribution shows items’ amount in the transaction and
transactions’ amount. For instance, 2159 transactions have only 1 item, 545
transactions have 7 items, and only 1 transaction has 27 items.</p>

<h3 id="model">Model</h3>

<p>The value of support is useful for creating the model. We can use the function
<code class="language-plaintext highlighter-rouge">itemFrequencyPlot()</code> to check top N frequent item.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">itemFrequencyPlot</span><span class="p">(</span><span class="n">Groceries</span><span class="p">,</span><span class="w"> </span><span class="n">topN</span><span class="o">=</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"absolute"</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s2">"Item Frequency"</span><span class="p">)</span></code></pre></figure>

<p align="center">
  <img alt="Item Frequency" src="/images/20171020-itemfrequency.png" />
</p>

<p>Now we have a clear idea about the data, next we can create the model.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">rules</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apriori</span><span class="w"> </span><span class="p">(</span><span class="n">Groceries</span><span class="p">,</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">supp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.001</span><span class="p">,</span><span class="w"> </span><span class="n">conf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">))</span><span class="w">

</span><span class="n">rulesLift</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="p">(</span><span class="n">rules</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lift"</span><span class="p">,</span><span class="w"> </span><span class="n">decreasing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span><span class="w">
</span><span class="n">inspect</span><span class="p">(</span><span class="n">head</span><span class="p">(</span><span class="n">rulesLift</span><span class="p">))</span><span class="w">
    </span><span class="n">lhs</span><span class="w">                                                  </span><span class="n">rhs</span><span class="w">              </span><span class="n">support</span><span class="w">     </span><span class="n">confidence</span><span class="w"> </span><span class="n">lift</span><span class="w">     </span><span class="n">count</span><span class="w">
</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="n">Instant</span><span class="w"> </span><span class="n">food</span><span class="w"> </span><span class="n">products</span><span class="p">,</span><span class="n">soda</span><span class="p">}</span><span class="w">                      </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="n">hamburger</span><span class="w"> </span><span class="n">meat</span><span class="p">}</span><span class="w"> </span><span class="m">0.001220132</span><span class="w"> </span><span class="m">0.6315789</span><span class="w">  </span><span class="m">18.99565</span><span class="w"> </span><span class="m">12</span><span class="w">
</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="n">soda</span><span class="p">,</span><span class="n">popcorn</span><span class="p">}</span><span class="w">                                    </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="n">salty</span><span class="w"> </span><span class="n">snack</span><span class="p">}</span><span class="w">    </span><span class="m">0.001220132</span><span class="w"> </span><span class="m">0.6315789</span><span class="w">  </span><span class="m">16.69779</span><span class="w"> </span><span class="m">12</span><span class="w">
</span><span class="p">[</span><span class="m">3</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="n">flour</span><span class="p">,</span><span class="n">baking</span><span class="w"> </span><span class="n">powder</span><span class="p">}</span><span class="w">                             </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="n">sugar</span><span class="p">}</span><span class="w">          </span><span class="m">0.001016777</span><span class="w"> </span><span class="m">0.5555556</span><span class="w">  </span><span class="m">16.40807</span><span class="w"> </span><span class="m">10</span><span class="w">
</span><span class="p">[</span><span class="m">4</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="n">ham</span><span class="p">,</span><span class="n">processed</span><span class="w"> </span><span class="n">cheese</span><span class="p">}</span><span class="w">                            </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="n">white</span><span class="w"> </span><span class="n">bread</span><span class="p">}</span><span class="w">    </span><span class="m">0.001931876</span><span class="w"> </span><span class="m">0.6333333</span><span class="w">  </span><span class="m">15.04549</span><span class="w"> </span><span class="m">19</span><span class="w">
</span><span class="p">[</span><span class="m">5</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="n">whole</span><span class="w"> </span><span class="n">milk</span><span class="p">,</span><span class="n">Instant</span><span class="w"> </span><span class="n">food</span><span class="w"> </span><span class="n">products</span><span class="p">}</span><span class="w">                </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="n">hamburger</span><span class="w"> </span><span class="n">meat</span><span class="p">}</span><span class="w"> </span><span class="m">0.001525165</span><span class="w"> </span><span class="m">0.5000000</span><span class="w">  </span><span class="m">15.03823</span><span class="w"> </span><span class="m">15</span><span class="w">
</span><span class="p">[</span><span class="m">6</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="n">other</span><span class="w"> </span><span class="n">vegetables</span><span class="p">,</span><span class="n">curd</span><span class="p">,</span><span class="n">yogurt</span><span class="p">,</span><span class="n">whipped</span><span class="o">/</span><span class="n">sour</span><span class="w"> </span><span class="n">cream</span><span class="p">}</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="n">cream</span><span class="w"> </span><span class="n">cheese</span><span class="w"> </span><span class="p">}</span><span class="w">  </span><span class="m">0.001016777</span><span class="w"> </span><span class="m">0.5882353</span><span class="w">  </span><span class="m">14.83409</span><span class="w"> </span><span class="m">10</span></code></pre></figure>

<p><code class="language-plaintext highlighter-rouge">inspect()</code> function shows us each rule in detail, its support value, confidence
value and lift value.</p>

<h3 id="visualisation">Visualisation</h3>

<h4 id="scatter-plot">Scatter plot</h4>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">arulesViz</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span><span class="w"> </span><span class="n">control</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">jitter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">shading</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lift"</span><span class="p">)</span></code></pre></figure>

<p align="center">
  <img alt="rules plot" src="/images/20171020-rulesplot.png" />
</p>

<p>According this scatter plot, we find that support values of association analysis
in general are lower, confidence values are well-distributed, and lift values of
most rules are greater than 3. So these rule are significant.</p>

<h4 id="grouped-matrix-plot">Grouped matrix plot</h4>

<p>Grouped matrix plot cluster similar rules, then shows the general distribution
of clustered rules. Be default, number of cluster is 20, here I set to 15.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">plot</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grouped"</span><span class="p">,</span><span class="w"> </span><span class="n">control</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span><span class="p">))</span></code></pre></figure>

<p align="center">
  <img alt="grouped matrix plot" src="/images/20171020-groupedmatrix.png" />
</p>

<p>Similar association rules are grouped into one cluster, which can extract the
overall regularities and similarities of association rules. Horizontal ordinate
stands for 15 clusters, vertical ordinate stands for the items generated by 15
rules. The depth of color presents the degree of lift, the deeper color is, the
larger lift is. The size of circle presents the degree of support, the bigger
circle is, the larger support is.</p>

<h4 id="graph-plot">Graph plot</h4>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">igraph</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">visNetwork</span><span class="p">)</span><span class="w">

</span><span class="n">subrules</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">head</span><span class="p">(</span><span class="n">sort</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lift"</span><span class="p">),</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">subrules</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"graph"</span><span class="p">)</span></code></pre></figure>

<p>Since there are enormous rules, here I just take 10 rules whose lifts are 10
largest, to make graph plot.</p>

<p align="center">
  <img alt="graph plot" src="/images/20171020-graphplot.png" />
</p>

<p>In this graph, resource means antecedent (LHS), arrow means relation direction,
the circle between them means the confidence of this rule. The bigger circle is,
the larger confidence is. The depth of color means the lift, the deeper color is,
the larger lift is. The end of arrow pointing means the consequent (RHS) of this
rule.</p>

<p>Following codes create a dynamic graph which is similar as above.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">graphDF</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">get.data.frame</span><span class="p">(</span><span class="n">plot</span><span class="p">(</span><span class="n">subrules</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"graph"</span><span class="p">),</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"both"</span><span class="p">)</span><span class="w">
</span><span class="n">visNetwork</span><span class="p">(</span><span class="w">
  </span><span class="n">nodes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">graphDF</span><span class="o">$</span><span class="n">vertices</span><span class="o">$</span><span class="n">name</span><span class="p">,</span><span class="w">
                      </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">graphDF</span><span class="o">$</span><span class="n">vertices</span><span class="o">$</span><span class="n">support</span><span class="p">,</span><span class="w">
                      </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">graphDF</span><span class="o">$</span><span class="n">vertices</span><span class="o">$</span><span class="n">label</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                                     </span><span class="n">graphDF</span><span class="o">$</span><span class="n">vertices</span><span class="o">$</span><span class="n">name</span><span class="p">,</span><span class="w">
                                     </span><span class="n">graphDF</span><span class="o">$</span><span class="n">vertices</span><span class="o">$</span><span class="n">label</span><span class="p">),</span><span class="w">
                      </span><span class="n">graphDF</span><span class="o">$</span><span class="n">vertices</span><span class="p">),</span><span class="w">
  </span><span class="n">edges</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">graphDF</span><span class="o">$</span><span class="n">edges</span><span class="w">
</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">visOptions</span><span class="p">(</span><span class="n">highlightNearest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span></code></pre></figure>

<iframe src="/images/20171020-dynamicgraph.html" style="display: block; width:100%; height: 550px">
  <p>Dynamic graph</p>
</iframe>

<p>How to understand this graph? Let’s take “yogurt” as an example. Click circle
“yogurt”, then the circle is linked with other 4 circles, 3 small and 1 big,
each of them stands for a basket. We can take the biggest one, click it, then we
find that in this basket, there are also butter, whole milk, domistic eggs,
tropical fruits and other vegetables. So we can say that all these products are
associated with yogurt.</p>

<p>Association analysis is a useful way to analyse the relation between 2 different
products, which can also help the decision of retailing.</p>

<h2 id="reference">Reference</h2>
<ul>
  <li>Junjie Xu, “assorted bottles and cans in commercial coolers”, <em>www.pexels.com</em>. [Online]. Available: <a href="https://www.pexels.com/photo/assorted-bottles-and-cans-in-commercial-coolers-3028500/">https://www.pexels.com/photo/assorted-bottles-and-cans-in-commercial-coolers-3028500/</a></li>
</ul>

</div><section class="article__sharing d-print-none"></section><div class="d-print-none"><footer class="article__footer"><meta itemprop="dateModified" content="2017-10-20T23:16:08+02:00"><!-- start custom article footer snippet -->

<!-- end custom article footer snippet -->
<div class="article__subscribe"><div class="subscribe"><i class="fas fa-rss"></i> <a type="application/rss+xml" href="/feed.xml">Subscribe</a></div></div><div class="article__license"><div class="license">
    <p>This work is licensed under a <a itemprop="license" rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">Attribution-NonCommercial 4.0 International</a> license.
      <a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">
        <img alt="Attribution-NonCommercial 4.0 International" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" />
      </a>
    </p>
  </div></div></footer>
<div class="article__section-navigator clearfix"><div class="previous"><span>PREVIOUS</span><a href="/posts/france-is-ai/">france is AI</a></div><div class="next"><span>NEXT</span><a href="/posts/review-of-2017/">Review of 2017</a></div></div></div>

</div>

<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    $(function() {
      var $this ,$scroll;
      var $articleContent = $('.js-article-content');
      var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
      var scroll = hasSidebar ? '.js-page-main' : 'html, body';
      $scroll = $(scroll);

      $articleContent.find('.highlight').each(function() {
        $this = $(this);
        $this.attr('data-lang', $this.find('code').attr('data-lang'));
      });
      $articleContent.find('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]').each(function() {
        $this = $(this);
        $this.append($('<a class="anchor d-print-none" aria-hidden="true"></a>').html('<i class="fas fa-anchor"></i>'));
      });
      $articleContent.on('click', '.anchor', function() {
        $scroll.scrollToAnchor('#' + $(this).parent().attr('id'), 400);
      });
    });
  });
})();
</script>
</div><section class="page__comments d-print-none"><div id="disqus_thread"></div>
  <script>
  /**
  *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
  *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
  var disqus_config = function () {
    this.page.url = 'https://jingwen-z.github.io//posts/association-analysis-apriori-algorithm/';
    this.page.identifier = '/posts/association-analysis-apriori-algorithm';
  };
  (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://jingwen-z.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></section></article><!-- start custom main bottom snippet -->

<!-- end custom main bottom snippet -->
</div>
            </div></div></div><div class="page__footer d-print-none">
<footer class="footer py-4 js-page-footer">
  <div class="main"><div itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jingwen Zheng"><meta itemprop="url" content="/"><meta itemprop="description" content="Data Science Enthusiast"><div class="footer__author-links"><div class="author-links">
  <ul class="menu menu--nowrap menu--inline"><li title="Follow me on Linkedin.">
        <a class="button button--circle linkedin-button" itemprop="sameAs" href="https://www.linkedin.com/in/jingwen-zheng" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M260.096 155.648c0 27.307008-9.899008 50.516992-29.696 69.632-19.796992 19.115008-45.396992 28.672-76.8 28.672-30.036992 0-54.612992-9.556992-73.728-28.672-19.115008-19.115008-28.672-42.324992-28.672-69.632 0-28.672 9.556992-52.224 28.672-70.656 19.115008-18.432 44.372992-27.648 75.776-27.648 31.403008 0 56.32 9.216 74.752 27.648 18.432 18.432 28.331008 41.984 29.696 70.656 0 0 0 0 0 0m-202.752 808.96c0 0 0-632.832 0-632.832 0 0 196.608 0 196.608 0 0 0 0 632.832 0 632.832 0 0-196.608 0-196.608 0 0 0 0 0 0 0m313.344-430.08c0-58.708992-1.364992-126.292992-4.096-202.752 0 0 169.984 0 169.984 0 0 0 10.24 88.064 10.24 88.064 0 0 4.096 0 4.096 0 40.96-68.267008 105.812992-102.4 194.56-102.4 68.267008 0 123.220992 22.868992 164.864 68.608 41.643008 45.739008 62.464 113.664 62.464 203.776 0 0 0 374.784 0 374.784 0 0-196.608 0-196.608 0 0 0 0-350.208 0-350.208 0-91.476992-33.451008-137.216-100.352-137.216-47.787008 0-81.236992 24.576-100.352 73.728-4.096 8.192-6.144 24.576-6.144 49.152 0 0 0 364.544 0 364.544 0 0-198.656 0-198.656 0 0 0 0-430.08 0-430.08 0 0 0 0 0 0" />
</svg>
</div>
        </a>
      </li><li title="Follow me on Github.">
        <a class="button button--circle github-button" itemprop="sameAs" href="https://github.com/jingwen-z" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path class="svgpath" data-index="path_0" fill="#272636" d="M0 525.2c0 223.6 143.3 413.7 343 483.5 26.9 6.8 22.8-12.4 22.8-25.4l0-88.7c-155.3 18.2-161.5-84.6-172-101.7-21.1-36-70.8-45.2-56-62.3 35.4-18.2 71.4 4.6 113.1 66.3 30.2 44.7 89.1 37.2 119 29.7 6.5-26.9 20.5-50.9 39.7-69.6C248.8 728.2 181.7 630 181.7 513.2c0-56.6 18.7-108.7 55.3-150.7-23.3-69.3 2.2-128.5 5.6-137.3 66.5-6 135.5 47.6 140.9 51.8 37.8-10.2 80.9-15.6 129.1-15.6 48.5 0 91.8 5.6 129.8 15.9 12.9-9.8 77-55.8 138.8-50.2 3.3 8.8 28.2 66.7 6.3 135 37.1 42.1 56 94.6 56 151.4 0 117-67.5 215.3-228.8 243.7 26.9 26.6 43.6 63.4 43.6 104.2l0 128.8c0.9 10.3 0 20.5 17.2 20.5C878.1 942.4 1024 750.9 1024 525.3c0-282.9-229.3-512-512-512C229.1 13.2 0 242.3 0 525.2L0 525.2z" />
</svg>
</div>
        </a>
      </li></ul>
</div>
</div>
    </div><div class="site-info mt-2">
      <div>© Jingwen Zheng 2021,
        Powered by <a title="Jekyll is a simple, blog-aware, static site generator." href="http://jekyllrb.com/">Jekyll</a> & <a
        title="TeXt is a super customizable Jekyll theme." href="https://github.com/kitian616/jekyll-TeXt-theme">TeXt Theme</a>.
      </div>
    </div>
  </div>
</footer>
</div></div>
    </div><script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $body = $('body'), $window = $(window);
    var $pageRoot = $('.js-page-root'), $pageMain = $('.js-page-main');
    var activeCount = 0;
    function modal(options) {
      var $root = this, visible, onChange, hideWhenWindowScroll = false;
      var scrollTop;
      function setOptions(options) {
        var _options = options || {};
        visible = _options.initialVisible === undefined ? false : show;
        onChange = _options.onChange;
        hideWhenWindowScroll = _options.hideWhenWindowScroll;
      }
      function init() {
        setState(visible);
      }
      function setState(isShow) {
        if (isShow === visible) {
          return;
        }
        visible = isShow;
        if (visible) {
          activeCount++;
          scrollTop = $(window).scrollTop() || $pageMain.scrollTop();
          $root.addClass('modal--show');
          $pageMain.scrollTop(scrollTop);
          activeCount === 1 && ($pageRoot.addClass('show-modal'), $body.addClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.on('scroll', hide);
          $window.on('keyup', handleKeyup);
        } else {
          activeCount > 0 && activeCount--;
          $root.removeClass('modal--show');
          $window.scrollTop(scrollTop);
          activeCount === 0 && ($pageRoot.removeClass('show-modal'), $body.removeClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.off('scroll', hide);
          $window.off('keyup', handleKeyup);
        }
        onChange && onChange(visible);
      }
      function show() {
        setState(true);
      }
      function hide() {
        setState(false);
      }
      function handleKeyup(e) {
        // Char Code: 27  ESC
        if (e.which ===  27) {
          hide();
        }
      }
      setOptions(options);
      init();
      return {
        show: show,
        hide: hide,
        $el: $root
      };
    }
    $.fn.modal = modal;
  });
})();
</script><div class="modal modal--overflow page__search-modal d-print-none js-page-search-modal"><script>
(function () {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    // search panel
    var search = (window.search || (window.search = {}));
    var useDefaultSearchBox = window.useDefaultSearchBox === undefined ?
      true : window.useDefaultSearchBox ;

    var $searchModal = $('.js-page-search-modal');
    var $searchToggle = $('.js-search-toggle');
    var searchModal = $searchModal.modal({ onChange: handleModalChange, hideWhenWindowScroll: true });
    var modalVisible = false;
    search.searchModal = searchModal;

    var $searchBox = null;
    var $searchInput = null;
    var $searchClear = null;

    function getModalVisible() {
      return modalVisible;
    }
    search.getModalVisible = getModalVisible;

    function handleModalChange(visible) {
      modalVisible = visible;
      if (visible) {
        search.onShow && search.onShow();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].focus();
      } else {
        search.onShow && search.onHide();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].blur();
        setTimeout(function() {
          useDefaultSearchBox && ($searchInput.val(''), $searchBox.removeClass('not-empty'));
          search.clear && search.clear();
          window.pageAsideAffix && window.pageAsideAffix.refresh();
        }, 400);
      }
    }

    $searchToggle.on('click', function() {
      modalVisible ? searchModal.hide() : searchModal.show();
    });
    // Char Code: 83  S, 191 /
    $(window).on('keyup', function(e) {
      if (!modalVisible && !window.isFormElement(e.target || e.srcElement) && (e.which === 83 || e.which === 191)) {
        modalVisible || searchModal.show();
      }
    });

    if (useDefaultSearchBox) {
      $searchBox = $('.js-search-box');
      $searchInput = $searchBox.children('input');
      $searchClear = $searchBox.children('.js-icon-clear');
      search.getSearchInput = function() {
        return $searchInput.get(0);
      };
      search.getVal = function() {
        return $searchInput.val();
      };
      search.setVal = function(val) {
        $searchInput.val(val);
      };

      $searchInput.on('focus', function() {
        $(this).addClass('focus');
      });
      $searchInput.on('blur', function() {
        $(this).removeClass('focus');
      });
      $searchInput.on('input', window.throttle(function() {
        var val = $(this).val();
        if (val === '' || typeof val !== 'string') {
          search.clear && search.clear();
        } else {
          $searchBox.addClass('not-empty');
          search.onInputNotEmpty && search.onInputNotEmpty(val);
        }
      }, 400));
      $searchClear.on('click', function() {
        $searchInput.val(''); $searchBox.removeClass('not-empty');
        search.clear && search.clear();
      });
    }
  });
})();
</script><div class="search search--dark">
  <div class="main">
    <div class="search__header">Search</div>
    <div class="search-bar">
      <div class="search-box js-search-box">
        <div class="search-box__icon-search"><i class="fas fa-search"></i></div>
        <input type="text" />
        <div class="search-box__icon-clear js-icon-clear">
          <a><i class="fas fa-times"></i></a>
        </div>
      </div>
      <button class="button button--theme-dark button--pill search__cancel js-search-toggle">
        Cancel</button>
    </div>
    <div class="search-result js-search-result"></div>
  </div>
</div>
<script>var SOURCES = window.TEXT_VARIABLES.sources;
var PAHTS = window.TEXT_VARIABLES.paths;
window.Lazyload.js([SOURCES.jquery, PAHTS.search_js], function() {
  var search = (window.search || (window.search = {}));
  var searchData = window.TEXT_SEARCH_DATA || {};

  function memorize(f) {
    var cache = {};
    return function () {
      var key = Array.prototype.join.call(arguments, ',');
      if (key in cache) return cache[key];
      else return cache[key] = f.apply(this, arguments);
    };
  }

  /// search
  function searchByQuery(query) {
    var i, j, key, keys, cur, _title, result = {};
    keys = Object.keys(searchData);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      for (j = 0; j < searchData[key].length; j++) {
        cur = searchData[key][j], _title = cur.title;
        if ((result[key] === undefined || result[key] && result[key].length < 4 )
          && _title.toLowerCase().indexOf(query.toLowerCase()) >= 0) {
          if (result[key] === undefined) {
            result[key] = [];
          }
          result[key].push(cur);
        }
      }
    }
    return result;
  }

  var renderHeader = memorize(function(header) {
    return $('<p class="search-result__header">' + header + '</p>');
  });

  var renderItem = function(index, title, url) {
    return $('<li class="search-result__item" data-index="' + index + '"><a class="button" href="' + url + '">' + title + '</a></li>');
  };

  function render(data) {
    if (!data) { return null; }
    var $root = $('<ul></ul>'), i, j, key, keys, cur, itemIndex = 0;
    keys = Object.keys(data);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      $root.append(renderHeader(key));
      for (j = 0; j < data[key].length; j++) {
        cur = data[key][j];
        $root.append(renderItem(itemIndex++, cur.title, cur.url));
      }
    }
    return $root;
  }

  // search box
  var $result = $('.js-search-result'), $resultItems;
  var lastActiveIndex, activeIndex;

  function clear() {
    $result.html(null);
    $resultItems = $('.search-result__item'); activeIndex = 0;
  }
  function onInputNotEmpty(val) {
    $result.html(render(searchByQuery(val)));
    $resultItems = $('.search-result__item'); activeIndex = 0;
    $resultItems.eq(0).addClass('active');
  }

  search.clear = clear;
  search.onInputNotEmpty = onInputNotEmpty;

  function updateResultItems() {
    lastActiveIndex >= 0 && $resultItems.eq(lastActiveIndex).removeClass('active');
    activeIndex >= 0 && $resultItems.eq(activeIndex).addClass('active');
  }

  function moveActiveIndex(direction) {
    var itemsCount = $resultItems ? $resultItems.length : 0;
    if (itemsCount > 1) {
      lastActiveIndex = activeIndex;
      if (direction === 'up') {
        activeIndex = (activeIndex - 1 + itemsCount) % itemsCount;
      } else if (direction === 'down') {
        activeIndex = (activeIndex + 1 + itemsCount) % itemsCount;
      }
      updateResultItems();
    }
  }

  // Char Code: 13  Enter, 37  ⬅, 38  ⬆, 39  ➡, 40  ⬇
  $(window).on('keyup', function(e) {
    var modalVisible = search.getModalVisible && search.getModalVisible();
    if (modalVisible) {
      if (e.which === 38) {
        modalVisible && moveActiveIndex('up');
      } else if (e.which === 40) {
        modalVisible && moveActiveIndex('down');
      } else if (e.which === 13) {
        modalVisible && $resultItems && activeIndex >= 0 && $resultItems.eq(activeIndex).children('a')[0].click();
      }
    }
  });

  $result.on('mouseover', '.search-result__item > a', function() {
    var itemIndex = $(this).parent().data('index');
    itemIndex >= 0 && (lastActiveIndex = activeIndex, activeIndex = itemIndex, updateResultItems());
  });
});
</script>
</div></div>


<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function scrollToAnchor(anchor, duration, callback) {
      var $root = this;
      $root.animate({ scrollTop: $(anchor).position().top }, duration, function() {
        window.history.replaceState(null, '', window.location.href.split('#')[0] + anchor);
        callback && callback();
      });
    }
    $.fn.scrollToAnchor = scrollToAnchor;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function affix(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroll,
        offsetBottom = 0, scrollTarget = window, scroll = window.document, disabled = false, isOverallScroller = true,
        rootTop, rootLeft, rootHeight, scrollBottom, rootBottomTop,
        hasInit = false, curState;

      function setOptions(options) {
        var _options = options || {};
        _options.offsetBottom && (offsetBottom = _options.offsetBottom);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroll && (scroll = _options.scroll);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $scrollTarget = $(scrollTarget);
        isOverallScroller = window.isOverallScroller($scrollTarget[0]);
        $scroll = $(scroll);
      }
      function preCalc() {
        top();
        rootHeight = $root.outerHeight();
        rootTop = $root.offset().top + (isOverallScroller ? 0 :  $scrollTarget.scrollTop());
        rootLeft = $root.offset().left;
      }
      function calc(needPreCalc) {
        needPreCalc && preCalc();
        scrollBottom = $scroll.outerHeight() - offsetBottom - rootHeight;
        rootBottomTop = scrollBottom - rootTop;
      }
      function top() {
        if (curState !== 'top') {
          $root.removeClass('fixed').css({
            left: 0,
            top: 0
          });
          curState = 'top';
        }
      }
      function fixed() {
        if (curState !== 'fixed') {
          $root.addClass('fixed').css({
            left: rootLeft + 'px',
            top: 0
          });
          curState = 'fixed';
        }
      }
      function bottom() {
        if (curState !== 'bottom') {
          $root.removeClass('fixed').css({
            left: 0,
            top: rootBottomTop + 'px'
          });
          curState = 'bottom';
        }
      }
      function setState() {
        var scrollTop = $scrollTarget.scrollTop();
        if (scrollTop >= rootTop && scrollTop <= scrollBottom) {
          fixed();
        } else if (scrollTop < rootTop) {
          top();
        } else {
          bottom();
        }
      }
      function init() {
        if(!hasInit) {
          var interval, timeout;
          calc(true); setState();
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState();
          });
          $window.on('resize', function() {
            disabled || (calc(true), setState());
          });
          hasInit = true;
        }
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions,
        refresh: function() {
          calc(true, { animation: false }); setState();
        }
      };
    }
    $.fn.affix = affix;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function toc(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroller, $tocUl = $('<ul class="toc toc--ellipsis"></ul>'), $tocLi, $headings, $activeLast, $activeCur,
        selectors = 'h1,h2,h3', container = 'body', scrollTarget = window, scroller = 'html, body', disabled = false,
        headingsPos, scrolling = false, hasRendered = false, hasInit = false;

      function setOptions(options) {
        var _options = options || {};
        _options.selectors && (selectors = _options.selectors);
        _options.container && (container = _options.container);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroller && (scroller = _options.scroller);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $headings = $(container).find(selectors).filter('[id]');
        $scrollTarget = $(scrollTarget);
        $scroller = $(scroller);
      }
      function calc() {
        headingsPos = [];
        $headings.each(function() {
          headingsPos.push(Math.floor($(this).position().top));
        });
      }
      function setState(element, disabled) {
        var scrollTop = $scrollTarget.scrollTop(), i;
        if (disabled || !headingsPos || headingsPos.length < 1) { return; }
        if (element) {
          $activeCur = element;
        } else {
          for (i = 0; i < headingsPos.length; i++) {
            if (scrollTop >= headingsPos[i]) {
              $activeCur = $tocLi.eq(i);
            } else {
              $activeCur || ($activeCur = $tocLi.eq(i));
              break;
            }
          }
        }
        $activeLast && $activeLast.removeClass('active');
        ($activeLast = $activeCur).addClass('active');
      }
      function render() {
        if(!hasRendered) {
          $root.append($tocUl);
          $headings.each(function() {
            var $this = $(this);
            $tocUl.append($('<li></li>').addClass('toc-' + $this.prop('tagName').toLowerCase())
              .append($('<a></a>').text($this.text()).attr('href', '#' + $this.prop('id'))));
          });
          $tocLi = $tocUl.children('li');
          $tocUl.on('click', 'a', function(e) {
            e.preventDefault();
            var $this = $(this);
            scrolling = true;
            setState($this.parent());
            $scroller.scrollToAnchor($this.attr('href'), 400, function() {
              scrolling = false;
            });
          });
        }
        hasRendered = true;
      }
      function init() {
        var interval, timeout;
        if(!hasInit) {
          render(); calc(); setState(null, scrolling);
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState(null, scrolling);
          });
          $window.on('resize', window.throttle(function() {
            if (!disabled) {
              render(); calc(); setState(null, scrolling);
            }
          }, 100));
        }
        hasInit = true;
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions
      };
    }
    $.fn.toc = toc;
  });
})();
/*(function () {

})();*/
</script><script>
  /* toc must before affix, since affix need to konw toc' height. */(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  var TOC_SELECTOR = window.TEXT_VARIABLES.site.toc.selectors;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window);
    var $articleContent = $('.js-article-content');
    var $tocRoot = $('.js-toc-root'), $col2 = $('.js-col-aside');
    var toc;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
    var hasToc = $articleContent.find(TOC_SELECTOR).length > 0;

    function disabled() {
      return $col2.css('display') === 'none' || !hasToc;
    }

    tocDisabled = disabled();

    toc = $tocRoot.toc({
      selectors: TOC_SELECTOR,
      container: $articleContent,
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      tocDisabled = disabled();
      toc && toc.setOptions({
        disabled: tocDisabled
      });
    }, 100));

  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window), $pageFooter = $('.js-page-footer');
    var $pageAside = $('.js-page-aside');
    var affix;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');

    affix = $pageAside.affix({
      offsetBottom: $pageFooter.outerHeight(),
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      scroll: hasSidebar ? $('.js-page-main').children() : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      affix && affix.setOptions({
        disabled: tocDisabled
      });
    }, 100));

    window.pageAsideAffix = affix;
  });
})();
</script>
    </div>
    <script>(function () {
  var $root = document.getElementsByClassName('root')[0];
  if (window.hasEvent('touchstart')) {
    $root.dataset.isTouch = true;
    document.addEventListener('touchstart', function(){}, false);
  }
})();
</script>
  </body>
</html>

